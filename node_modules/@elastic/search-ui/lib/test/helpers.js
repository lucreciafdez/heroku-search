"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.getMockApiConnector = getMockApiConnector;
exports.setupDriver = setupDriver;
exports.doesStateHaveResponseData = doesStateHaveResponseData;
exports.getSearchCalls = getSearchCalls;
exports.getAutocompleteCalls = getAutocompleteCalls;
exports.getClickCalls = getClickCalls;
exports.getAutocompleteClickCalls = getAutocompleteClickCalls;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _objectWithoutProperties2 = _interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties"));

var _SearchDriver = _interopRequireDefault(require("../SearchDriver"));

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(source, true).forEach(function (key) { (0, _defineProperty2.default)(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(source).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

var suggestions = {
  documents: [{
    suggestion: "carlsbad"
  }, {
    suggestion: "carlsbad caverns"
  }, {
    suggestion: "carolina"
  }]
};
var searchResponse = {
  totalResults: 1000,
  totalPages: 100,
  requestId: "12345",
  facets: {},
  results: [{}, {}]
};
var autocompleteSearchResponse = {
  requestId: "6789",
  results: [{}, {}]
};

function getMockApiConnector() {
  return {
    onAutocomplete: jest.fn().mockReturnValue({
      then: function then(cb) {
        return cb({
          autocompletedResults: autocompleteSearchResponse.results,
          autocompletedResultsRequestId: autocompleteSearchResponse.requestId,
          autocompletedSuggestions: suggestions
        });
      }
    }),
    onSearch: jest.fn().mockReturnValue({
      then: function then(cb) {
        return cb(searchResponse);
      }
    }),
    onResultClick: jest.fn().mockReturnValue({
      then: function then() {}
    }),
    onAutocompleteResultClick: jest.fn().mockReturnValue({
      then: function then() {}
    })
  };
}

function setupDriver() {
  var _ref = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},
      mockSearchResponse = _ref.mockSearchResponse,
      rest = (0, _objectWithoutProperties2.default)(_ref, ["mockSearchResponse"]);

  var mockApiConnector = getMockApiConnector();

  if (mockSearchResponse) {
    mockApiConnector.onSearch = jest.fn().mockReturnValue({
      then: function then(cb) {
        return cb(mockSearchResponse);
      }
    });
  }

  var driver = new _SearchDriver.default(_objectSpread({
    apiConnector: mockApiConnector
  }, rest, {
    // We don't want to deal with async in our tests, so pass 0 so URL state
    // pushes happen synchronously
    urlPushDebounceLength: 0
  }));
  var updatedStateAfterAction = {};
  driver.subscribeToStateChanges(function (newState) {
    updatedStateAfterAction.state = newState;
  });
  jest.runAllTimers();
  return {
    stateAfterCreation: driver.getState(),
    driver: driver,
    updatedStateAfterAction: updatedStateAfterAction,
    mockApiConnector: mockApiConnector
  };
}

function doesStateHaveResponseData(response) {
  var requestId = response.requestId,
      results = response.results,
      totalPages = response.totalPages,
      totalResults = response.totalResults,
      wasSearched = response.wasSearched;
  return !!results && results.length && !!requestId && totalPages > 0 && totalResults > 0 && !!wasSearched;
}

function getSearchCalls(mockApiConnector) {
  return mockApiConnector.onSearch.mock.calls;
}

function getAutocompleteCalls(mockApiConnector) {
  return mockApiConnector.onAutocomplete.mock.calls;
}

function getClickCalls(mockApiConnector) {
  return mockApiConnector.onResultClick.mock.calls;
}

function getAutocompleteClickCalls(mockApiConnector) {
  return mockApiConnector.onAutocompleteResultClick.mock.calls;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy90ZXN0L2hlbHBlcnMuanMiXSwibmFtZXMiOlsic3VnZ2VzdGlvbnMiLCJkb2N1bWVudHMiLCJzdWdnZXN0aW9uIiwic2VhcmNoUmVzcG9uc2UiLCJ0b3RhbFJlc3VsdHMiLCJ0b3RhbFBhZ2VzIiwicmVxdWVzdElkIiwiZmFjZXRzIiwicmVzdWx0cyIsImF1dG9jb21wbGV0ZVNlYXJjaFJlc3BvbnNlIiwiZ2V0TW9ja0FwaUNvbm5lY3RvciIsIm9uQXV0b2NvbXBsZXRlIiwiamVzdCIsImZuIiwibW9ja1JldHVyblZhbHVlIiwidGhlbiIsImNiIiwiYXV0b2NvbXBsZXRlZFJlc3VsdHMiLCJhdXRvY29tcGxldGVkUmVzdWx0c1JlcXVlc3RJZCIsImF1dG9jb21wbGV0ZWRTdWdnZXN0aW9ucyIsIm9uU2VhcmNoIiwib25SZXN1bHRDbGljayIsIm9uQXV0b2NvbXBsZXRlUmVzdWx0Q2xpY2siLCJzZXR1cERyaXZlciIsIm1vY2tTZWFyY2hSZXNwb25zZSIsInJlc3QiLCJtb2NrQXBpQ29ubmVjdG9yIiwiZHJpdmVyIiwiU2VhcmNoRHJpdmVyIiwiYXBpQ29ubmVjdG9yIiwidXJsUHVzaERlYm91bmNlTGVuZ3RoIiwidXBkYXRlZFN0YXRlQWZ0ZXJBY3Rpb24iLCJzdWJzY3JpYmVUb1N0YXRlQ2hhbmdlcyIsIm5ld1N0YXRlIiwic3RhdGUiLCJydW5BbGxUaW1lcnMiLCJzdGF0ZUFmdGVyQ3JlYXRpb24iLCJnZXRTdGF0ZSIsImRvZXNTdGF0ZUhhdmVSZXNwb25zZURhdGEiLCJyZXNwb25zZSIsIndhc1NlYXJjaGVkIiwibGVuZ3RoIiwiZ2V0U2VhcmNoQ2FsbHMiLCJtb2NrIiwiY2FsbHMiLCJnZXRBdXRvY29tcGxldGVDYWxscyIsImdldENsaWNrQ2FsbHMiLCJnZXRBdXRvY29tcGxldGVDbGlja0NhbGxzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7Ozs7OztBQUVBLElBQU1BLFdBQVcsR0FBRztBQUNsQkMsRUFB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cmNoRHJpdmVyIGZyb20gXCIuLi9TZWFyY2hEcml2ZXJcIjtcblxuY29uc3Qgc3VnZ2VzdGlvbnMgPSB7XG4gIGRvY3VtZW50czogW1xuICAgIHtcbiAgICAgIHN1Z2dlc3Rpb246IFwiY2FybHNiYWRcIlxuICAgIH0sXG4gICAge1xuICAgICAgc3VnZ2VzdGlvbjogXCJjYXJsc2JhZCBjYXZlcm5zXCJcbiAgICB9LFxuICAgIHtcbiAgICAgIHN1Z2dlc3Rpb246IFwiY2Fyb2xpbmFcIlxuICAgIH1cbiAgXVxufTtcblxuY29uc3Qgc2VhcmNoUmVzcG9uc2UgPSB7XG4gIHRvdGFsUmVzdWx0czogMTAwMCxcbiAgdG90YWxQYWdlczogMTAwLFxuICByZXF1ZXN0SWQ6IFwiMTIzNDVcIixcbiAgZmFjZXRzOiB7fSxcbiAgcmVzdWx0czogW3t9LCB7fV1cbn07XG5cbmNvbnN0IGF1dG9jb21wbGV0ZVNlYXJjaFJlc3BvbnNlID0ge1xuICByZXF1ZXN0SWQ6IFwiNjc4OVwiLFxuICByZXN1bHRzOiBbe30sIHt9XVxufTtcblxuZXhwb3J0IGZ1bmN0aW9uIGdldE1vY2tBcGlDb25uZWN0b3IoKSB7XG4gIHJldHVybiB7XG4gICAgb25BdXRvY29tcGxldGU6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoe1xuICAgICAgdGhlbjogY2IgPT5cbiAgICAgICAgY2Ioe1xuICAgICAgICAgIGF1dG9jb21wbGV0ZWRSZXN1bHRzOiBhdXRvY29tcGxldGVTZWFyY2hSZXNwb25zZS5yZXN1bHRzLFxuICAgICAgICAgIGF1dG9jb21wbGV0ZWRSZXN1bHRzUmVxdWVzdElkOiBhdXRvY29tcGxldGVTZWFyY2hSZXNwb25zZS5yZXF1ZXN0SWQsXG4gICAgICAgICAgYXV0b2NvbXBsZXRlZFN1Z2dlc3Rpb25zOiBzdWdnZXN0aW9uc1xuICAgICAgICB9KVxuICAgIH0pLFxuICAgIG9uU2VhcmNoOiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHsgdGhlbjogY2IgPT4gY2Ioc2VhcmNoUmVzcG9uc2UpIH0pLFxuICAgIG9uUmVzdWx0Q2xpY2s6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoeyB0aGVuOiAoKSA9PiB7fSB9KSxcbiAgICBvbkF1dG9jb21wbGV0ZVJlc3VsdENsaWNrOiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHsgdGhlbjogKCkgPT4ge30gfSlcbiAgfTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHNldHVwRHJpdmVyKHsgbW9ja1NlYXJjaFJlc3BvbnNlLCAuLi5yZXN0IH0gPSB7fSkge1xuICBjb25zdCBtb2NrQXBpQ29ubmVjdG9yID0gZ2V0TW9ja0FwaUNvbm5lY3RvcigpO1xuXG4gIGlmIChtb2NrU2VhcmNoUmVzcG9uc2UpIHtcbiAgICBtb2NrQXBpQ29ubmVjdG9yLm9uU2VhcmNoID0gamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7XG4gICAgICB0aGVuOiBjYiA9PiBjYihtb2NrU2VhcmNoUmVzcG9uc2UpXG4gICAgfSk7XG4gIH1cblxuICBjb25zdCBkcml2ZXIgPSBuZXcgU2VhcmNoRHJpdmVyKHtcbiAgICBhcGlDb25uZWN0b3I6IG1vY2tBcGlDb25uZWN0b3IsXG4gICAgLy8gUGFzcywgZS5nLiwgaW5pdGlhbFN0YXRlIGFuZCBhbGwgb3RoZXIgY29uZmlnc1xuICAgIC4uLnJlc3QsXG4gICAgLy8gV2UgZG9uJ3Qgd2FudCB0byBkZWFsIHdpdGggYXN5bmMgaW4gb3VyIHRlc3RzLCBzbyBwYXNzIDAgc28gVVJMIHN0YXRlXG4gICAgLy8gcHVzaGVzIGhhcHBlbiBzeW5jaHJvbm91c2x5XG4gICAgdXJsUHVzaERlYm91bmNlTGVuZ3RoOiAwXG4gIH0pO1xuXG4gIGNvbnN0IHVwZGF0ZWRTdGF0ZUFmdGVyQWN0aW9uID0ge307XG4gIGRyaXZlci5zdWJzY3JpYmVUb1N0YXRlQ2hhbmdlcyhuZXdTdGF0ZSA9PiB7XG4gICAgdXBkYXRlZFN0YXRlQWZ0ZXJBY3Rpb24uc3RhdGUgPSBuZXdTdGF0ZTtcbiAgfSk7XG5cbiAgamVzdC5ydW5BbGxUaW1lcnMoKTtcblxuICByZXR1cm4ge1xuICAgIHN0YXRlQWZ0ZXJDcmVhdGlvbjogZHJpdmVyLmdldFN0YXRlKCksXG4gICAgZHJpdmVyLFxuICAgIHVwZGF0ZWRTdGF0ZUFmdGVyQWN0aW9uLFxuICAgIG1vY2tBcGlDb25uZWN0b3JcbiAgfTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGRvZXNTdGF0ZUhhdmVSZXNwb25zZURhdGEocmVzcG9uc2UpIHtcbiAgY29uc3Qge1xuICAgIHJlcXVlc3RJZCxcbiAgICByZXN1bHRzLFxuICAgIHRvdGFsUGFnZXMsXG4gICAgdG90YWxSZXN1bHRzLFxuICAgIHdhc1NlYXJjaGVkXG4gIH0gPSByZXNwb25zZTtcbiAgcmV0dXJuIChcbiAgICAhIXJlc3VsdHMgJiZcbiAgICByZXN1bHRzLmxlbmd0aCAmJlxuICAgICEhcmVxdWVzdElkICYmXG4gICAgdG90YWxQYWdlcyA+IDAgJiZcbiAgICB0b3RhbFJlc3VsdHMgPiAwICYmXG4gICAgISF3YXNTZWFyY2hlZFxuICApO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0U2VhcmNoQ2FsbHMobW9ja0FwaUNvbm5lY3Rvcikge1xuICByZXR1cm4gbW9ja0FwaUNvbm5lY3Rvci5vblNlYXJjaC5tb2NrLmNhbGxzO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0QXV0b2NvbXBsZXRlQ2FsbHMobW9ja0FwaUNvbm5lY3Rvcikge1xuICByZXR1cm4gbW9ja0FwaUNvbm5lY3Rvci5vbkF1dG9jb21wbGV0ZS5tb2NrLmNhbGxzO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0Q2xpY2tDYWxscyhtb2NrQXBpQ29ubmVjdG9yKSB7XG4gIHJldHVybiBtb2NrQXBpQ29ubmVjdG9yLm9uUmVzdWx0Q2xpY2subW9jay5jYWxscztcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldEF1dG9jb21wbGV0ZUNsaWNrQ2FsbHMobW9ja0FwaUNvbm5lY3Rvcikge1xuICByZXR1cm4gbW9ja0FwaUNvbm5lY3Rvci5vbkF1dG9jb21wbGV0ZVJlc3VsdENsaWNrLm1vY2suY2FsbHM7XG59XG4iXX0=