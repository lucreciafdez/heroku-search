import _extends from "@babel/runtime/helpers/extends";
import _defineProperty from "@babel/runtime/helpers/defineProperty";
import _objectWithoutProperties from "@babel/runtime/helpers/objectWithoutProperties";

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(source, true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(source).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

import PropTypes from "prop-types";
import React from "react";
import Downshift from "downshift";
import { Result } from "./types";
import { Suggestion } from "./types";
import { appendClassName } from "./view-helpers";
import Autocomplete from "./Autocomplete";
import SearchInput from "./SearchInput";

function SearchBox(props) {
  var className = props.className,
      allAutocompletedItemsCount = props.allAutocompletedItemsCount,
      autocompleteView = props.autocompleteView,
      isFocused = props.isFocused,
      _props$inputProps = props.inputProps,
      inputProps = _props$inputProps === void 0 ? {} : _props$inputProps,
      inputView = props.inputView,
      onChange = props.onChange,
      onSelectAutocomplete = props.onSelectAutocomplete,
      _onSubmit = props.onSubmit,
      useAutocomplete = props.useAutocomplete,
      value = props.value,
      autocompletedResults = props.autocompletedResults,
      autocompletedSuggestions = props.autocompletedSuggestions,
      autocompletedSuggestionsCount = props.autocompletedSuggestionsCount,
      completeSuggestion = props.completeSuggestion,
      notifyAutocompleteSelected = props.notifyAutocompleteSelected,
      rest = _objectWithoutProperties(props, ["className", "allAutocompletedItemsCount", "autocompleteView", "isFocused", "inputProps", "inputView", "onChange", "onSelectAutocomplete", "onSubmit", "useAutocomplete", "value", "autocompletedResults", "autocompletedSuggestions", "autocompletedSuggestionsCount", "completeSuggestion", "notifyAutocompleteSelected"]);

  var focusedClass = isFocused ? "focus" : "";
  var AutocompleteView = autocompleteView || Autocomplete;
  var InputView = inputView || SearchInput;
  return React.createElement(Downshift, _extends({
    inputValue: value,
    onChange: onSelectAutocomplete,
    onInputValueChange: function onInputValueChange(newValue) {
      // To avoid over dispatching
      if (value === newValue) return;
      onChange(newValue);
    } // Because when a selection is made, we don't really want to change
    // the inputValue. This is supposed to be a "controlled" value, and when
    // this happens we lose control of it.
    ,
    itemToString: function itemToString() {
      return value;
    }
  }, rest), function (downshiftProps) {
    var closeMenu = downshiftProps.closeMenu,
        _getInputProps = downshiftProps.getInputProps,
        isOpen = downshiftProps.isOpen;
    var autocompleteClass = isOpen === true ? " autocomplete" : "";
    return React.createElement("form", {
      onSubmit: function onSubmit(e) {
        closeMenu();

        _onSubmit(e);
      }
    }, React.createElement("div", {
      className: appendClassName("sui-search-box", className) + autocompleteClass
    }, React.createElement(InputView, _extends({}, downshiftProps, {
      getInputProps: function getInputProps(additionalProps) {
        var _ref = additionalProps || {},
            className = _ref.className,
            rest = _objectWithoutProperties(_ref, ["className"]);

        return _getInputProps(_objectSpread({
          placeholder: "Search"
        }, inputProps, {
          className: appendClassName("sui-search-box__text-input", [inputProps.className, className, focusedClass])
        }, rest));
      },
      getButtonProps: function getButtonProps(additionalProps) {
        var _ref2 = additionalProps || {},
            className = _ref2.className,
            rest = _objectWithoutProperties(_ref2, ["className"]);

        return _objectSpread({
          type: "submit",
          value: "Search",
          className: appendClassName("button sui-search-box__submit", className)
        }, rest);
      },
      getAutocomplete: function getAutocomplete() {
        if (useAutocomplete && isOpen && allAutocompletedItemsCount > 0) {
          return React.createElement(AutocompleteView, _extends({}, props, downshiftProps));
        } else {
          return null;
        }
      }
    }))));
  });
}

SearchBox.propTypes = {
  // Provided by container
  allAutocompletedItemsCount: PropTypes.number.isRequired,
  autocompletedResults: PropTypes.arrayOf(Result).isRequired,
  autocompletedSuggestions: PropTypes.objectOf(PropTypes.arrayOf(Suggestion)).isRequired,
  autocompletedSuggestionsCount: PropTypes.number.isRequired,
  completeSuggestion: PropTypes.func.isRequired,
  notifyAutocompleteSelected: PropTypes.func.isRequired,
  onChange: PropTypes.func.isRequired,
  onSubmit: PropTypes.func.isRequired,
  value: PropTypes.string.isRequired,
  autocompleteResults: PropTypes.oneOfType([PropTypes.bool, PropTypes.shape({
    titleField: PropTypes.string.isRequired,
    urlField: PropTypes.string.isRequired,
    linkTarget: PropTypes.string,
    sectionTitle: PropTypes.string
  })]),
  autocompleteView: PropTypes.func,
  autocompleteSuggestions: PropTypes.oneOfType([PropTypes.bool, PropTypes.exact({
    sectionTitle: PropTypes.string
  }), PropTypes.objectOf(PropTypes.exact({
    sectionTitle: PropTypes.string
  }))]),
  className: PropTypes.string,
  inputProps: PropTypes.object,
  inputView: PropTypes.func,
  isFocused: PropTypes.bool,
  useAutocomplete: PropTypes.bool,
  // Specific configuration for this view only
  onSelectAutocomplete: PropTypes.func
};
export default SearchBox;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9TZWFyY2hCb3guanMiXSwibmFtZXMiOlsiUHJvcFR5cGVzIiwiUmVhY3QiLCJEb3duc2hpZnQiLCJSZXN1bHQiLCJTdWdnZXN0aW9uIiwiYXBwZW5kQ2xhc3NOYW1lIiwiQXV0b2NvbXBsZXRlIiwiU2VhcmNoSW5wdXQiLCJTZWFyY2hCb3giLCJwcm9wcyIsImNsYXNzTmFtZSIsImFsbEF1dG9jb21wbGV0ZWRJdGVtc0NvdW50IiwiYXV0b2NvbXBsZXRlVmlldyIsImlzRm9jdXNlZCIsImlucHV0UHJvcHMiLCJpbnB1dFZpZXciLCJvbkNoYW5nZSIsIm9uU2VsZWN0QXV0b2NvbXBsZXRlIiwib25TdWJtaXQiLCJ1c2VBdXRvY29tcGxldGUiLCJ2YWx1ZSIsImF1dG9jb21wbGV0ZWRSZXN1bHRzIiwiYXV0b2NvbXBsZXRlZFN1Z2dlc3Rpb25zIiwiYXV0b2NvbXBsZXRlZFN1Z2dlc3Rpb25zQ291bnQiLCJjb21wbGV0ZVN1Z2dlc3Rpb24iLCJub3RpZnlBdXRvY29tcGxldGVTZWxlY3RlZCIsInJlc3QiLCJmb2N1c2VkQ2xhc3MiLCJBdXRvY29tcGxldGVWaWV3IiwiSW5wdXRWaWV3IiwibmV3VmFsdWUiLCJkb3duc2hpZnRQcm9wcyIsImNsb3NlTWVudSIsImdldElucHV0UHJvcHMiLCJpc09wZW4iLCJhdXRvY29tcGxldGVDbGFzcyIsImUiLCJhZGRpdGlvbmFsUHJvcHMiLCJwbGFjZWhvbGRlciIsInR5cGUiLCJwcm9wVHlwZXMiLCJudW1iZXIiLCJpc1JlcXVpcmVkIiwiYXJyYXlPZiIsIm9iamVjdE9mIiwiZnVuYyIsInN0cmluZyIsImF1dG9jb21wbGV0ZVJlc3VsdHMiLCJvbmVPZlR5cGUiLCJib29sIiwic2hhcGUiLCJ0aXRsZUZpZWxkIiwidXJsRmllbGQiLCJsaW5rVGFyZ2V0Iiwic2VjdGlvblRpdGxlIiwiYXV0b2NvbXBsZXRlU3VnZ2VzdGlvbnMiLCJleGFjdCIsIm9iamVjdCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQSxP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QUpWLEdBQWhCLENBRnVDLENBQXBCLENBWkQ7QUFxQnBCbEMsRUFBQUEsZ0JBQWdCLEVBQUVaLFNBQVMsQ0FBQzZDLElBckJSO0FBc0JwQlUsRUFBQUEsdUJBQXVCLEVBQUV2RCxTQUFTLENBQUNnRCxTQUFWLENBQW9CLENBQzNDaEQsU0FBUyxDQUFDaUQsSUFEaUMsRUFFM0NqRCxTQUFTLENBQUN3RCxLQUFWLENBQWdCO0FBQ2RGLElBQUFBLFlBQVksRUFBRXRELFNBQVMsQ0FBQzhDO0FBRFYsR0FBaEIsQ0FGMkMsRUFLM0M5QyxTQUFTLENBQUM0QyxRQUFWLENBQ0U1QyxTQUFTLENBQUN3RCxLQUFWLENBQWdCO0FBQ2RGLElBQUFBLFlBQVksRUFBRXRELFNBQVMsQ0FBQzhDO0FBRFYsR0FBaEIsQ0FERixDQUwyQyxDQUFwQixDQXRCTDtBQWlDcEJwQyxFQUFBQSxTQUFTLEVBQUVWLFNBQVMsQ0FBQzhDLE1BakNEO0FBa0NwQmhDLEVBQUFBLFVBQVUsRUFBRWQsU0FBUyxDQUFDeUQsTUFsQ0Y7QUFtQ3BCMUMsRUFBQUEsU0FBUyxFQUFFZixTQUFTLENBQUM2QyxJQW5DRDtBQW9DcEJoQyxFQUFBQSxTQUFTLEVBQUViLFNBQVMsQ0FBQ2lELElBcENEO0FBcUNwQjlCLEVBQUFBLGVBQWUsRUFBRW5CLFNBQVMsQ0FBQ2lELElBckNQO0FBdUNwQjtBQUNBaEMsRUFBQUEsb0JBQW9CLEVBQUVqQixTQUFTLENBQUM2QztBQXhDWixDQUF0QjtBQTJDQSxlQUFlckMsU0FBZiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBQcm9wVHlwZXMgZnJvbSBcInByb3AtdHlwZXNcIjtcbmltcG9ydCBSZWFjdCBmcm9tIFwicmVhY3RcIjtcbmltcG9ydCBEb3duc2hpZnQgZnJvbSBcImRvd25zaGlmdFwiO1xuXG5pbXBvcnQgeyBSZXN1bHQgfSBmcm9tIFwiLi90eXBlc1wiO1xuaW1wb3J0IHsgU3VnZ2VzdGlvbiB9IGZyb20gXCIuL3R5cGVzXCI7XG5pbXBvcnQgeyBhcHBlbmRDbGFzc05hbWUgfSBmcm9tIFwiLi92aWV3LWhlbHBlcnNcIjtcblxuaW1wb3J0IEF1dG9jb21wbGV0ZSBmcm9tIFwiLi9BdXRvY29tcGxldGVcIjtcbmltcG9ydCBTZWFyY2hJbnB1dCBmcm9tIFwiLi9TZWFyY2hJbnB1dFwiO1xuXG5mdW5jdGlvbiBTZWFyY2hCb3gocHJvcHMpIHtcbiAgY29uc3Qge1xuICAgIGNsYXNzTmFtZSxcbiAgICBhbGxBdXRvY29tcGxldGVkSXRlbXNDb3VudCxcbiAgICBhdXRvY29tcGxldGVWaWV3LFxuICAgIGlzRm9jdXNlZCxcbiAgICBpbnB1dFByb3BzID0ge30sXG4gICAgaW5wdXRWaWV3LFxuICAgIG9uQ2hhbmdlLFxuICAgIG9uU2VsZWN0QXV0b2NvbXBsZXRlLFxuICAgIG9uU3VibWl0LFxuICAgIHVzZUF1dG9jb21wbGV0ZSxcbiAgICB2YWx1ZSxcbiAgICAvLyBOT1RFOiBUaGVzZSBhcmUgZXhwbGljaXRseSBkZS1zdHJ1Y3R1cmVkIGJ1dCBub3QgdXNlZCBzbyB0aGF0IHRoZXkgYXJlXG4gICAgLy8gbm90IHBhc3NlZCB0aHJvdWdoIHRvIHRoZSBpbnB1dCB3aXRoIHRoZSAncmVzdCcgcGFyYW1ldGVyXG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXVudXNlZC12YXJzXG4gICAgYXV0b2NvbXBsZXRlZFJlc3VsdHMsXG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXVudXNlZC12YXJzXG4gICAgYXV0b2NvbXBsZXRlZFN1Z2dlc3Rpb25zLFxuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby11bnVzZWQtdmFyc1xuICAgIGF1dG9jb21wbGV0ZWRTdWdnZXN0aW9uc0NvdW50LFxuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby11bnVzZWQtdmFyc1xuICAgIGNvbXBsZXRlU3VnZ2VzdGlvbixcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tdW51c2VkLXZhcnNcbiAgICBub3RpZnlBdXRvY29tcGxldGVTZWxlY3RlZCxcbiAgICAuLi5yZXN0XG4gIH0gPSBwcm9wcztcbiAgY29uc3QgZm9jdXNlZENsYXNzID0gaXNGb2N1c2VkID8gXCJmb2N1c1wiIDogXCJcIjtcbiAgY29uc3QgQXV0b2NvbXBsZXRlVmlldyA9IGF1dG9jb21wbGV0ZVZpZXcgfHwgQXV0b2NvbXBsZXRlO1xuICBjb25zdCBJbnB1dFZpZXcgPSBpbnB1dFZpZXcgfHwgU2VhcmNoSW5wdXQ7XG5cbiAgcmV0dXJuIChcbiAgICA8RG93bnNoaWZ0XG4gICAgICBpbnB1dFZhbHVlPXt2YWx1ZX1cbiAgICAgIG9uQ2hhbmdlPXtvblNlbGVjdEF1dG9jb21wbGV0ZX1cbiAgICAgIG9uSW5wdXRWYWx1ZUNoYW5nZT17bmV3VmFsdWUgPT4ge1xuICAgICAgICAvLyBUbyBhdm9pZCBvdmVyIGRpc3BhdGNoaW5nXG4gICAgICAgIGlmICh2YWx1ZSA9PT0gbmV3VmFsdWUpIHJldHVybjtcbiAgICAgICAgb25DaGFuZ2UobmV3VmFsdWUpO1xuICAgICAgfX1cbiAgICAgIC8vIEJlY2F1c2Ugd2hlbiBhIHNlbGVjdGlvbiBpcyBtYWRlLCB3ZSBkb24ndCByZWFsbHkgd2FudCB0byBjaGFuZ2VcbiAgICAgIC8vIHRoZSBpbnB1dFZhbHVlLiBUaGlzIGlzIHN1cHBvc2VkIHRvIGJlIGEgXCJjb250cm9sbGVkXCIgdmFsdWUsIGFuZCB3aGVuXG4gICAgICAvLyB0aGlzIGhhcHBlbnMgd2UgbG9zZSBjb250cm9sIG9mIGl0LlxuICAgICAgaXRlbVRvU3RyaW5nPXsoKSA9PiB2YWx1ZX1cbiAgICAgIHsuLi5yZXN0fVxuICAgID5cbiAgICAgIHtkb3duc2hpZnRQcm9wcyA9PiB7XG4gICAgICAgIGNvbnN0IHsgY2xvc2VNZW51LCBnZXRJbnB1dFByb3BzLCBpc09wZW4gfSA9IGRvd25zaGlmdFByb3BzO1xuICAgICAgICBsZXQgYXV0b2NvbXBsZXRlQ2xhc3MgPSBpc09wZW4gPT09IHRydWUgPyBcIiBhdXRvY29tcGxldGVcIiA6IFwiXCI7XG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgPGZvcm1cbiAgICAgICAgICAgIG9uU3VibWl0PXtlID0+IHtcbiAgICAgICAgICAgICAgY2xvc2VNZW51KCk7XG4gICAgICAgICAgICAgIG9uU3VibWl0KGUpO1xuICAgICAgICAgICAgfX1cbiAgICAgICAgICA+XG4gICAgICAgICAgICA8ZGl2XG4gICAgICAgICAgICAgIGNsYXNzTmFtZT17XG4gICAgICAgICAgICAgICAgYXBwZW5kQ2xhc3NOYW1lKFwic3VpLXNlYXJjaC1ib3hcIiwgY2xhc3NOYW1lKSArIGF1dG9jb21wbGV0ZUNsYXNzXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgPElucHV0Vmlld1xuICAgICAgICAgICAgICAgIHsuLi5kb3duc2hpZnRQcm9wc31cbiAgICAgICAgICAgICAgICBnZXRJbnB1dFByb3BzPXthZGRpdGlvbmFsUHJvcHMgPT4ge1xuICAgICAgICAgICAgICAgICAgY29uc3QgeyBjbGFzc05hbWUsIC4uLnJlc3QgfSA9IGFkZGl0aW9uYWxQcm9wcyB8fCB7fTtcbiAgICAgICAgICAgICAgICAgIHJldHVybiBnZXRJbnB1dFByb3BzKHtcbiAgICAgICAgICAgICAgICAgICAgcGxhY2Vob2xkZXI6IFwiU2VhcmNoXCIsXG4gICAgICAgICAgICAgICAgICAgIC4uLmlucHV0UHJvcHMsXG4gICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogYXBwZW5kQ2xhc3NOYW1lKFwic3VpLXNlYXJjaC1ib3hfX3RleHQtaW5wdXRcIiwgW1xuICAgICAgICAgICAgICAgICAgICAgIGlucHV0UHJvcHMuY2xhc3NOYW1lLFxuICAgICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICBmb2N1c2VkQ2xhc3NcbiAgICAgICAgICAgICAgICAgICAgXSksXG4gICAgICAgICAgICAgICAgICAgIC4uLnJlc3RcbiAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH19XG4gICAgICAgICAgICAgICAgZ2V0QnV0dG9uUHJvcHM9e2FkZGl0aW9uYWxQcm9wcyA9PiB7XG4gICAgICAgICAgICAgICAgICBjb25zdCB7IGNsYXNzTmFtZSwgLi4ucmVzdCB9ID0gYWRkaXRpb25hbFByb3BzIHx8IHt9O1xuICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJzdWJtaXRcIixcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IFwiU2VhcmNoXCIsXG4gICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogYXBwZW5kQ2xhc3NOYW1lKFxuICAgICAgICAgICAgICAgICAgICAgIFwiYnV0dG9uIHN1aS1zZWFyY2gtYm94X19zdWJtaXRcIixcbiAgICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWVcbiAgICAgICAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICAgICAgICAgLi4ucmVzdFxuICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB9fVxuICAgICAgICAgICAgICAgIGdldEF1dG9jb21wbGV0ZT17KCkgPT4ge1xuICAgICAgICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgICAgICAgICB1c2VBdXRvY29tcGxldGUgJiZcbiAgICAgICAgICAgICAgICAgICAgaXNPcGVuICYmXG4gICAgICAgICAgICAgICAgICAgIGFsbEF1dG9jb21wbGV0ZWRJdGVtc0NvdW50ID4gMFxuICAgICAgICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiA8QXV0b2NvbXBsZXRlVmlldyB7Li4ucHJvcHN9IHsuLi5kb3duc2hpZnRQcm9wc30gLz47XG4gICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9fVxuICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgPC9mb3JtPlxuICAgICAgICApO1xuICAgICAgfX1cbiAgICA8L0Rvd25zaGlmdD5cbiAgKTtcbn1cblxuU2VhcmNoQm94LnByb3BUeXBlcyA9IHtcbiAgLy8gUHJvdmlkZWQgYnkgY29udGFpbmVyXG4gIGFsbEF1dG9jb21wbGV0ZWRJdGVtc0NvdW50OiBQcm9wVHlwZXMubnVtYmVyLmlzUmVxdWlyZWQsXG4gIGF1dG9jb21wbGV0ZWRSZXN1bHRzOiBQcm9wVHlwZXMuYXJyYXlPZihSZXN1bHQpLmlzUmVxdWlyZWQsXG4gIGF1dG9jb21wbGV0ZWRTdWdnZXN0aW9uczogUHJvcFR5cGVzLm9iamVjdE9mKFByb3BUeXBlcy5hcnJheU9mKFN1Z2dlc3Rpb24pKVxuICAgIC5pc1JlcXVpcmVkLFxuICBhdXRvY29tcGxldGVkU3VnZ2VzdGlvbnNDb3VudDogUHJvcFR5cGVzLm51bWJlci5pc1JlcXVpcmVkLFxuICBjb21wbGV0ZVN1Z2dlc3Rpb246IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXG4gIG5vdGlmeUF1dG9jb21wbGV0ZVNlbGVjdGVkOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICBvbkNoYW5nZTogUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCxcbiAgb25TdWJtaXQ6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXG4gIHZhbHVlOiBQcm9wVHlwZXMuc3RyaW5nLmlzUmVxdWlyZWQsXG4gIGF1dG9jb21wbGV0ZVJlc3VsdHM6IFByb3BUeXBlcy5vbmVPZlR5cGUoW1xuICAgIFByb3BUeXBlcy5ib29sLFxuICAgIFByb3BUeXBlcy5zaGFwZSh7XG4gICAgICB0aXRsZUZpZWxkOiBQcm9wVHlwZXMuc3RyaW5nLmlzUmVxdWlyZWQsXG4gICAgICB1cmxGaWVsZDogUHJvcFR5cGVzLnN0cmluZy5pc1JlcXVpcmVkLFxuICAgICAgbGlua1RhcmdldDogUHJvcFR5cGVzLnN0cmluZyxcbiAgICAgIHNlY3Rpb25UaXRsZTogUHJvcFR5cGVzLnN0cmluZ1xuICAgIH0pXG4gIF0pLFxuICBhdXRvY29tcGxldGVWaWV3OiBQcm9wVHlwZXMuZnVuYyxcbiAgYXV0b2NvbXBsZXRlU3VnZ2VzdGlvbnM6IFByb3BUeXBlcy5vbmVPZlR5cGUoW1xuICAgIFByb3BUeXBlcy5ib29sLFxuICAgIFByb3BUeXBlcy5leGFjdCh7XG4gICAgICBzZWN0aW9uVGl0bGU6IFByb3BUeXBlcy5zdHJpbmdcbiAgICB9KSxcbiAgICBQcm9wVHlwZXMub2JqZWN0T2YoXG4gICAgICBQcm9wVHlwZXMuZXhhY3Qoe1xuICAgICAgICBzZWN0aW9uVGl0bGU6IFByb3BUeXBlcy5zdHJpbmdcbiAgICAgIH0pXG4gICAgKVxuICBdKSxcbiAgY2xhc3NOYW1lOiBQcm9wVHlwZXMuc3RyaW5nLFxuICBpbnB1dFByb3BzOiBQcm9wVHlwZXMub2JqZWN0LFxuICBpbnB1dFZpZXc6IFByb3BUeXBlcy5mdW5jLFxuICBpc0ZvY3VzZWQ6IFByb3BUeXBlcy5ib29sLFxuICB1c2VBdXRvY29tcGxldGU6IFByb3BUeXBlcy5ib29sLFxuXG4gIC8vIFNwZWNpZmljIGNvbmZpZ3VyYXRpb24gZm9yIHRoaXMgdmlldyBvbmx5XG4gIG9uU2VsZWN0QXV0b2NvbXBsZXRlOiBQcm9wVHlwZXMuZnVuY1xufTtcblxuZXhwb3J0IGRlZmF1bHQgU2VhcmNoQm94O1xuIl19