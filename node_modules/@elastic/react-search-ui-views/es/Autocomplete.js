import _slicedToArray from "@babel/runtime/helpers/slicedToArray";
import PropTypes from "prop-types";
import React from "react";
import { Result } from "./types";
import { Suggestion } from "./types";
import { appendClassName } from "./view-helpers";

function getRaw(result, value) {
  if (!result[value] || !result[value].raw) return;
  return result[value].raw;
}

function getSnippet(result, value) {
  if (!result[value] || !result[value].snippet) return;
  return result[value].snippet;
}

function getSuggestionTitle(suggestionType, autocompleteSuggestions) {
  if (autocompleteSuggestions.sectionTitle) {
    return autocompleteSuggestions.sectionTitle;
  }

  if (autocompleteSuggestions[suggestionType] && autocompleteSuggestions[suggestionType].sectionTitle) {
    return autocompleteSuggestions[suggestionType].sectionTitle;
  }
}

function Autocomplete(_ref) {
  var autocompleteResults = _ref.autocompleteResults,
      autocompletedResults = _ref.autocompletedResults,
      autocompleteSuggestions = _ref.autocompleteSuggestions,
      autocompletedSuggestions = _ref.autocompletedSuggestions,
      className = _ref.className,
      getItemProps = _ref.getItemProps,
      getMenuProps = _ref.getMenuProps;
  var index = 0;
  return React.createElement("div", getMenuProps({
    className: appendClassName("sui-search-box__autocomplete-container", className)
  }), React.createElement("div", null, !!autocompleteSuggestions && Object.entries(autocompletedSuggestions).map(function (_ref2) {
    var _ref3 = _slicedToArray(_ref2, 2),
        suggestionType = _ref3[0],
        suggestions = _ref3[1];

    return React.createElement(React.Fragment, {
      key: suggestionType
    }, getSuggestionTitle(suggestionType, autocompleteSuggestions) && suggestions.length > 0 && React.createElement("div", {
      className: "sui-search-box__section-title"
    }, getSuggestionTitle(suggestionType, autocompleteSuggestions)), suggestions.length > 0 && React.createElement("ul", {
      className: "sui-search-box__suggestion-list"
    }, suggestions.map(function (suggestion) {
      index++;
      return (// eslint-disable-next-line react/jsx-key
        React.createElement("li", getItemProps({
          key: suggestion.suggestion || suggestion.highlight,
          index: index - 1,
          item: suggestion
        }), suggestion.highlight ? React.createElement("span", {
          dangerouslySetInnerHTML: {
            __html: suggestion.highlight
          }
        }) : React.createElement("span", null, suggestion.suggestion))
      );
    })));
  }), !!autocompleteResults && !!autocompletedResults && autocompletedResults.length > 0 && autocompleteResults.sectionTitle && React.createElement("div", {
    className: "sui-search-box__section-title"
  }, autocompleteResults.sectionTitle), !!autocompleteResults && !!autocompletedResults && autocompletedResults.length > 0 && React.createElement("ul", {
    className: "sui-search-box__results-list"
  }, autocompletedResults.map(function (result) {
    index++;
    var titleSnippet = getSnippet(result, autocompleteResults.titleField);
    var titleRaw = getRaw(result, autocompleteResults.titleField);
    return (// eslint-disable-next-line react/jsx-key
      React.createElement("li", getItemProps({
        key: result.id.raw,
        index: index - 1,
        item: result
      }), titleSnippet ? React.createElement("span", {
        dangerouslySetInnerHTML: {
          __html: titleSnippet
        }
      }) : React.createElement("span", null, titleRaw))
    );
  }))));
}

Autocomplete.propTypes = {
  allAutocompletedItemsCount: PropTypes.number.isRequired,
  autocompleteResults: PropTypes.oneOfType([PropTypes.bool, PropTypes.shape({
    titleField: PropTypes.string.isRequired,
    urlField: PropTypes.string.isRequired,
    linkTarget: PropTypes.string,
    sectionTitle: PropTypes.string
  })]),
  autocompletedResults: PropTypes.arrayOf(Result).isRequired,
  autocompletedSuggestions: PropTypes.objectOf(PropTypes.arrayOf(Suggestion)).isRequired,
  autocompletedSuggestionsCount: PropTypes.number.isRequired,
  autocompleteSuggestions: PropTypes.oneOfType([PropTypes.bool, PropTypes.exact({
    sectionTitle: PropTypes.string
  }), PropTypes.objectOf(PropTypes.exact({
    sectionTitle: PropTypes.string
  }))]),
  getItemProps: PropTypes.func.isRequired,
  getMenuProps: PropTypes.func.isRequired,
  className: PropTypes.string
};
export default Autocomplete;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9BdXRvY29tcGxldGUuanMiXSwibmFtZXMiOlsiUHJvcFR5cGVzIiwiUmVhY3QiLCJSZXN1bHQiLCJTdWdnZXN0aW9uIiwiYXBwZW5kQ2xhc3NOYW1lIiwiZ2V0UmF3IiwicmVzdWx0IiwidmFsdWUiLCJyYXciLCJnZXRTbmlwcGV0Iiwic25pcHBldCIsImdldFN1Z2dlc3Rpb25UaXRsZSIsInN1Z2dlc3Rpb25UeXBlIiwiYXV0b2NvbXBsZXRlU3VnZ2VzdGlvbnMiLCJzZWN0aW9uVGl0bGUiLCJBdXRvY29tcGxldGUiLCJhdXRvY29tcGxldGVSZXN1bHRzIiwiYXV0b2NvbXBsZXRlZFJlc3VsdHMiLCJhdXRvY29tcGxldGVkU3VnZ2VzdGlvbnMiLCJjbGFzc05hbWUiLCJnZXRJdGVtUHJvcHMiLCJnZXRNZW51UHJvcHMiLCJpbmRleCIsIk9iamVjdCIsImVudHJpZXMiLCJtYXAiLCJzdWdnZXN0aW9ucyIsImxlbmd0aCIsInN1Z2dlc3Rpb24iLCJrZXkiLCJoaWdobGlnaHQiLCJpdGVtIiwiX19odG1sIiwidGl0bGVTbmlwcGV0IiwidGl0bGVGaWVsZCIsInRpdGxlUmF3IiwiaWQiLCJwcm9wVHlwZXMiLCJhbGxBdXRvY29tcGxldGVkSXRlbXNDb3VudCIsIm51bWJlciIsImlzUmVxdWlyZWQiLCJvbmVPZlR5cGUiLCJib29sIiwic2hhcGUiLCJzdHJpbmciLCJ1cmxGaWVsZCIsImxpbmtUYXJnZXQiLCJhcnJheU9mIiwib2JqZWN0T2YiLCJhdXRvY29tcGxldGVkU3VnZ2VzdGlvbnNDb3VudCIsImV4YWN0IiwiZnVuYyJdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU9BLFNBQVAsTUFBc0IsWUFBdEI7QUFDQSxPQUFPQyxLQUFQLE1BQWtCLE9BQWxCO0FBRUEsU0FBU0MsTUFBVCxRQUF1QixTQUF2QjtBQUNBLFNBQVNDLFVBQVQsUUFBMkIsU0FBM0I7QUFDQSxTQUFTQyxlQUFULFFBQWdDLGdCQUFoQzs7QUFFQSxTQUFTQyxNQUFULENBQWdCQyxN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QVMsQ0FBQ21ELElBQVYsQ0FBZVgsVUEzQk47QUE0QnZCckIsRUFBQUEsU0FBUyxFQUFFbkIsU0FBUyxDQUFDNEM7QUE1QkUsQ0FBekI7QUErQkEsZUFBZTdCLFlBQWYiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUHJvcFR5cGVzIGZyb20gXCJwcm9wLXR5cGVzXCI7XG5pbXBvcnQgUmVhY3QgZnJvbSBcInJlYWN0XCI7XG5cbmltcG9ydCB7IFJlc3VsdCB9IGZyb20gXCIuL3R5cGVzXCI7XG5pbXBvcnQgeyBTdWdnZXN0aW9uIH0gZnJvbSBcIi4vdHlwZXNcIjtcbmltcG9ydCB7IGFwcGVuZENsYXNzTmFtZSB9IGZyb20gXCIuL3ZpZXctaGVscGVyc1wiO1xuXG5mdW5jdGlvbiBnZXRSYXcocmVzdWx0LCB2YWx1ZSkge1xuICBpZiAoIXJlc3VsdFt2YWx1ZV0gfHwgIXJlc3VsdFt2YWx1ZV0ucmF3KSByZXR1cm47XG4gIHJldHVybiByZXN1bHRbdmFsdWVdLnJhdztcbn1cblxuZnVuY3Rpb24gZ2V0U25pcHBldChyZXN1bHQsIHZhbHVlKSB7XG4gIGlmICghcmVzdWx0W3ZhbHVlXSB8fCAhcmVzdWx0W3ZhbHVlXS5zbmlwcGV0KSByZXR1cm47XG4gIHJldHVybiByZXN1bHRbdmFsdWVdLnNuaXBwZXQ7XG59XG5cbmZ1bmN0aW9uIGdldFN1Z2dlc3Rpb25UaXRsZShzdWdnZXN0aW9uVHlwZSwgYXV0b2NvbXBsZXRlU3VnZ2VzdGlvbnMpIHtcbiAgaWYgKGF1dG9jb21wbGV0ZVN1Z2dlc3Rpb25zLnNlY3Rpb25UaXRsZSkge1xuICAgIHJldHVybiBhdXRvY29tcGxldGVTdWdnZXN0aW9ucy5zZWN0aW9uVGl0bGU7XG4gIH1cblxuICBpZiAoXG4gICAgYXV0b2NvbXBsZXRlU3VnZ2VzdGlvbnNbc3VnZ2VzdGlvblR5cGVdICYmXG4gICAgYXV0b2NvbXBsZXRlU3VnZ2VzdGlvbnNbc3VnZ2VzdGlvblR5cGVdLnNlY3Rpb25UaXRsZVxuICApIHtcbiAgICByZXR1cm4gYXV0b2NvbXBsZXRlU3VnZ2VzdGlvbnNbc3VnZ2VzdGlvblR5cGVdLnNlY3Rpb25UaXRsZTtcbiAgfVxufVxuXG5mdW5jdGlvbiBBdXRvY29tcGxldGUoe1xuICBhdXRvY29tcGxldGVSZXN1bHRzLFxuICBhdXRvY29tcGxldGVkUmVzdWx0cyxcbiAgYXV0b2NvbXBsZXRlU3VnZ2VzdGlvbnMsXG4gIGF1dG9jb21wbGV0ZWRTdWdnZXN0aW9ucyxcbiAgY2xhc3NOYW1lLFxuICBnZXRJdGVtUHJvcHMsXG4gIGdldE1lbnVQcm9wc1xufSkge1xuICBsZXQgaW5kZXggPSAwO1xuICByZXR1cm4gKFxuICAgIDxkaXZcbiAgICAgIHsuLi5nZXRNZW51UHJvcHMoe1xuICAgICAgICBjbGFzc05hbWU6IGFwcGVuZENsYXNzTmFtZShcbiAgICAgICAgICBcInN1aS1zZWFyY2gtYm94X19hdXRvY29tcGxldGUtY29udGFpbmVyXCIsXG4gICAgICAgICAgY2xhc3NOYW1lXG4gICAgICAgIClcbiAgICAgIH0pfVxuICAgID5cbiAgICAgIDxkaXY+XG4gICAgICAgIHshIWF1dG9jb21wbGV0ZVN1Z2dlc3Rpb25zICYmXG4gICAgICAgICAgT2JqZWN0LmVudHJpZXMoYXV0b2NvbXBsZXRlZFN1Z2dlc3Rpb25zKS5tYXAoXG4gICAgICAgICAgICAoW3N1Z2dlc3Rpb25UeXBlLCBzdWdnZXN0aW9uc10pID0+IHtcbiAgICAgICAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgICAgICA8UmVhY3QuRnJhZ21lbnQga2V5PXtzdWdnZXN0aW9uVHlwZX0+XG4gICAgICAgICAgICAgICAgICB7Z2V0U3VnZ2VzdGlvblRpdGxlKFxuICAgICAgICAgICAgICAgICAgICBzdWdnZXN0aW9uVHlwZSxcbiAgICAgICAgICAgICAgICAgICAgYXV0b2NvbXBsZXRlU3VnZ2VzdGlvbnNcbiAgICAgICAgICAgICAgICAgICkgJiZcbiAgICAgICAgICAgICAgICAgICAgc3VnZ2VzdGlvbnMubGVuZ3RoID4gMCAmJiAoXG4gICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJzdWktc2VhcmNoLWJveF9fc2VjdGlvbi10aXRsZVwiPlxuICAgICAgICAgICAgICAgICAgICAgICAge2dldFN1Z2dlc3Rpb25UaXRsZShcbiAgICAgICAgICAgICAgICAgICAgICAgICAgc3VnZ2VzdGlvblR5cGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGF1dG9jb21wbGV0ZVN1Z2dlc3Rpb25zXG4gICAgICAgICAgICAgICAgICAgICAgICApfVxuICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgICAgICApfVxuICAgICAgICAgICAgICAgICAge3N1Z2dlc3Rpb25zLmxlbmd0aCA+IDAgJiYgKFxuICAgICAgICAgICAgICAgICAgICA8dWwgY2xhc3NOYW1lPVwic3VpLXNlYXJjaC1ib3hfX3N1Z2dlc3Rpb24tbGlzdFwiPlxuICAgICAgICAgICAgICAgICAgICAgIHtzdWdnZXN0aW9ucy5tYXAoc3VnZ2VzdGlvbiA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpbmRleCsrO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIHJlYWN0L2pzeC1rZXlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgPGxpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgey4uLmdldEl0ZW1Qcm9wcyh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBrZXk6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1Z2dlc3Rpb24uc3VnZ2VzdGlvbiB8fCBzdWdnZXN0aW9uLmhpZ2hsaWdodCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluZGV4OiBpbmRleCAtIDEsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtOiBzdWdnZXN0aW9uXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSl9XG4gICAgICAgICAgICAgICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7c3VnZ2VzdGlvbi5oaWdobGlnaHQgPyAoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYW5nZXJvdXNseVNldElubmVySFRNTD17e1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9faHRtbDogc3VnZ2VzdGlvbi5oaWdobGlnaHRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKSA6IChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuPntzdWdnZXN0aW9uLnN1Z2dlc3Rpb259PC9zcGFuPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICl9XG4gICAgICAgICAgICAgICAgICAgICAgICAgIDwvbGk+XG4gICAgICAgICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgICAgICAgIH0pfVxuICAgICAgICAgICAgICAgICAgICA8L3VsPlxuICAgICAgICAgICAgICAgICAgKX1cbiAgICAgICAgICAgICAgICA8L1JlYWN0LkZyYWdtZW50PlxuICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICl9XG4gICAgICAgIHshIWF1dG9jb21wbGV0ZVJlc3VsdHMgJiZcbiAgICAgICAgICAhIWF1dG9jb21wbGV0ZWRSZXN1bHRzICYmXG4gICAgICAgICAgYXV0b2NvbXBsZXRlZFJlc3VsdHMubGVuZ3RoID4gMCAmJlxuICAgICAgICAgIGF1dG9jb21wbGV0ZVJlc3VsdHMuc2VjdGlvblRpdGxlICYmIChcbiAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwic3VpLXNlYXJjaC1ib3hfX3NlY3Rpb24tdGl0bGVcIj5cbiAgICAgICAgICAgICAge2F1dG9jb21wbGV0ZVJlc3VsdHMuc2VjdGlvblRpdGxlfVxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgKX1cbiAgICAgICAgeyEhYXV0b2NvbXBsZXRlUmVzdWx0cyAmJlxuICAgICAgICAgICEhYXV0b2NvbXBsZXRlZFJlc3VsdHMgJiZcbiAgICAgICAgICBhdXRvY29tcGxldGVkUmVzdWx0cy5sZW5ndGggPiAwICYmIChcbiAgICAgICAgICAgIDx1bCBjbGFzc05hbWU9XCJzdWktc2VhcmNoLWJveF9fcmVzdWx0cy1saXN0XCI+XG4gICAgICAgICAgICAgIHthdXRvY29tcGxldGVkUmVzdWx0cy5tYXAocmVzdWx0ID0+IHtcbiAgICAgICAgICAgICAgICBpbmRleCsrO1xuICAgICAgICAgICAgICAgIGNvbnN0IHRpdGxlU25pcHBldCA9IGdldFNuaXBwZXQoXG4gICAgICAgICAgICAgICAgICByZXN1bHQsXG4gICAgICAgICAgICAgICAgICBhdXRvY29tcGxldGVSZXN1bHRzLnRpdGxlRmllbGRcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgIGNvbnN0IHRpdGxlUmF3ID0gZ2V0UmF3KHJlc3VsdCwgYXV0b2NvbXBsZXRlUmVzdWx0cy50aXRsZUZpZWxkKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIHJlYWN0L2pzeC1rZXlcbiAgICAgICAgICAgICAgICAgIDxsaVxuICAgICAgICAgICAgICAgICAgICB7Li4uZ2V0SXRlbVByb3BzKHtcbiAgICAgICAgICAgICAgICAgICAgICBrZXk6IHJlc3VsdC5pZC5yYXcsXG4gICAgICAgICAgICAgICAgICAgICAgaW5kZXg6IGluZGV4IC0gMSxcbiAgICAgICAgICAgICAgICAgICAgICBpdGVtOiByZXN1bHRcbiAgICAgICAgICAgICAgICAgICAgfSl9XG4gICAgICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgICAgIHt0aXRsZVNuaXBwZXQgPyAoXG4gICAgICAgICAgICAgICAgICAgICAgPHNwYW5cbiAgICAgICAgICAgICAgICAgICAgICAgIGRhbmdlcm91c2x5U2V0SW5uZXJIVE1MPXt7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIF9faHRtbDogdGl0bGVTbmlwcGV0XG4gICAgICAgICAgICAgICAgICAgICAgICB9fVxuICAgICAgICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgICAgICAgICkgOiAoXG4gICAgICAgICAgICAgICAgICAgICAgPHNwYW4+e3RpdGxlUmF3fTwvc3Bhbj5cbiAgICAgICAgICAgICAgICAgICAgKX1cbiAgICAgICAgICAgICAgICAgIDwvbGk+XG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgfSl9XG4gICAgICAgICAgICA8L3VsPlxuICAgICAgICAgICl9XG4gICAgICA8L2Rpdj5cbiAgICA8L2Rpdj5cbiAgKTtcbn1cblxuQXV0b2NvbXBsZXRlLnByb3BUeXBlcyA9IHtcbiAgYWxsQXV0b2NvbXBsZXRlZEl0ZW1zQ291bnQ6IFByb3BUeXBlcy5udW1iZXIuaXNSZXF1aXJlZCxcbiAgYXV0b2NvbXBsZXRlUmVzdWx0czogUHJvcFR5cGVzLm9uZU9mVHlwZShbXG4gICAgUHJvcFR5cGVzLmJvb2wsXG4gICAgUHJvcFR5cGVzLnNoYXBlKHtcbiAgICAgIHRpdGxlRmllbGQ6IFByb3BUeXBlcy5zdHJpbmcuaXNSZXF1aXJlZCxcbiAgICAgIHVybEZpZWxkOiBQcm9wVHlwZXMuc3RyaW5nLmlzUmVxdWlyZWQsXG4gICAgICBsaW5rVGFyZ2V0OiBQcm9wVHlwZXMuc3RyaW5nLFxuICAgICAgc2VjdGlvblRpdGxlOiBQcm9wVHlwZXMuc3RyaW5nXG4gICAgfSlcbiAgXSksXG4gIGF1dG9jb21wbGV0ZWRSZXN1bHRzOiBQcm9wVHlwZXMuYXJyYXlPZihSZXN1bHQpLmlzUmVxdWlyZWQsXG4gIGF1dG9jb21wbGV0ZWRTdWdnZXN0aW9uczogUHJvcFR5cGVzLm9iamVjdE9mKFByb3BUeXBlcy5hcnJheU9mKFN1Z2dlc3Rpb24pKVxuICAgIC5pc1JlcXVpcmVkLFxuICBhdXRvY29tcGxldGVkU3VnZ2VzdGlvbnNDb3VudDogUHJvcFR5cGVzLm51bWJlci5pc1JlcXVpcmVkLFxuICBhdXRvY29tcGxldGVTdWdnZXN0aW9uczogUHJvcFR5cGVzLm9uZU9mVHlwZShbXG4gICAgUHJvcFR5cGVzLmJvb2wsXG4gICAgUHJvcFR5cGVzLmV4YWN0KHtcbiAgICAgIHNlY3Rpb25UaXRsZTogUHJvcFR5cGVzLnN0cmluZ1xuICAgIH0pLFxuICAgIFByb3BUeXBlcy5vYmplY3RPZihcbiAgICAgIFByb3BUeXBlcy5leGFjdCh7XG4gICAgICAgIHNlY3Rpb25UaXRsZTogUHJvcFR5cGVzLnN0cmluZ1xuICAgICAgfSlcbiAgICApXG4gIF0pLFxuICBnZXRJdGVtUHJvcHM6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXG4gIGdldE1lbnVQcm9wczogUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCxcbiAgY2xhc3NOYW1lOiBQcm9wVHlwZXMuc3RyaW5nXG59O1xuXG5leHBvcnQgZGVmYXVsdCBBdXRvY29tcGxldGU7XG4iXX0=