"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _react = _interopRequireDefault(require("react"));

var _types = require("./types");

var _viewHelpers = require("./view-helpers");

function getRaw(result, value) {
  if (!result[value] || !result[value].raw) return;
  return result[value].raw;
}

function getSnippet(result, value) {
  if (!result[value] || !result[value].snippet) return;
  return result[value].snippet;
}

function getSuggestionTitle(suggestionType, autocompleteSuggestions) {
  if (autocompleteSuggestions.sectionTitle) {
    return autocompleteSuggestions.sectionTitle;
  }

  if (autocompleteSuggestions[suggestionType] && autocompleteSuggestions[suggestionType].sectionTitle) {
    return autocompleteSuggestions[suggestionType].sectionTitle;
  }
}

function Autocomplete(_ref) {
  var autocompleteResults = _ref.autocompleteResults,
      autocompletedResults = _ref.autocompletedResults,
      autocompleteSuggestions = _ref.autocompleteSuggestions,
      autocompletedSuggestions = _ref.autocompletedSuggestions,
      className = _ref.className,
      getItemProps = _ref.getItemProps,
      getMenuProps = _ref.getMenuProps;
  var index = 0;
  return _react.default.createElement("div", getMenuProps({
    className: (0, _viewHelpers.appendClassName)("sui-search-box__autocomplete-container", className)
  }), _react.default.createElement("div", null, !!autocompleteSuggestions && Object.entries(autocompletedSuggestions).map(function (_ref2) {
    var _ref3 = (0, _slicedToArray2.default)(_ref2, 2),
        suggestionType = _ref3[0],
        suggestions = _ref3[1];

    return _react.default.createElement(_react.default.Fragment, {
      key: suggestionType
    }, getSuggestionTitle(suggestionType, autocompleteSuggestions) && suggestions.length > 0 && _react.default.createElement("div", {
      className: "sui-search-box__section-title"
    }, getSuggestionTitle(suggestionType, autocompleteSuggestions)), suggestions.length > 0 && _react.default.createElement("ul", {
      className: "sui-search-box__suggestion-list"
    }, suggestions.map(function (suggestion) {
      index++;
      return (// eslint-disable-next-line react/jsx-key
        _react.default.createElement("li", getItemProps({
          key: suggestion.suggestion || suggestion.highlight,
          index: index - 1,
          item: suggestion
        }), suggestion.highlight ? _react.default.createElement("span", {
          dangerouslySetInnerHTML: {
            __html: suggestion.highlight
          }
        }) : _react.default.createElement("span", null, suggestion.suggestion))
      );
    })));
  }), !!autocompleteResults && !!autocompletedResults && autocompletedResults.length > 0 && autocompleteResults.sectionTitle && _react.default.createElement("div", {
    className: "sui-search-box__section-title"
  }, autocompleteResults.sectionTitle), !!autocompleteResults && !!autocompletedResults && autocompletedResults.length > 0 && _react.default.createElement("ul", {
    className: "sui-search-box__results-list"
  }, autocompletedResults.map(function (result) {
    index++;
    var titleSnippet = getSnippet(result, autocompleteResults.titleField);
    var titleRaw = getRaw(result, autocompleteResults.titleField);
    return (// eslint-disable-next-line react/jsx-key
      _react.default.createElement("li", getItemProps({
        key: result.id.raw,
        index: index - 1,
        item: result
      }), titleSnippet ? _react.default.createElement("span", {
        dangerouslySetInnerHTML: {
          __html: titleSnippet
        }
      }) : _react.default.createElement("span", null, titleRaw))
    );
  }))));
}

Autocomplete.propTypes = {
  allAutocompletedItemsCount: _propTypes.default.number.isRequired,
  autocompleteResults: _propTypes.default.oneOfType([_propTypes.default.bool, _propTypes.default.shape({
    titleField: _propTypes.default.string.isRequired,
    urlField: _propTypes.default.string.isRequired,
    linkTarget: _propTypes.default.string,
    sectionTitle: _propTypes.default.string
  })]),
  autocompletedResults: _propTypes.default.arrayOf(_types.Result).isRequired,
  autocompletedSuggestions: _propTypes.default.objectOf(_propTypes.default.arrayOf(_types.Suggestion)).isRequired,
  autocompletedSuggestionsCount: _propTypes.default.number.isRequired,
  autocompleteSuggestions: _propTypes.default.oneOfType([_propTypes.default.bool, _propTypes.default.exact({
    sectionTitle: _propTypes.default.string
  }), _propTypes.default.objectOf(_propTypes.default.exact({
    sectionTitle: _propTypes.default.string
  }))]),
  getItemProps: _propTypes.default.func.isRequired,
  getMenuProps: _propTypes.default.func.isRequired,
  className: _propTypes.default.string
};
var _default = Autocomplete;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9BdXRvY29tcGxldGUuanMiXSwibmFtZXMiOlsiZ2V0UmF3IiwicmVzdWx0IiwidmFsdWUiLCJyYXciLCJnZXRTbmlwcGV0Iiwic25pcHBldCIsImdldFN1Z2dlc3Rpb25UaXRsZSIsInN1Z2dlc3Rpb25UeXBlIiwiYXV0b2NvbXBsZXRlU3VnZ2VzdGlvbnMiLCJzZWN0aW9uVGl0bGUiLCJBdXRvY29tcGxldGUiLCJhdXRvY29tcGxldGVSZXN1bHRzIiwiYXV0b2NvbXBsZXRlZFJlc3VsdHMiLCJhdXRvY29tcGxldGVkU3VnZ2VzdGlvbnMiLCJjbGFzc05hbWUiLCJnZXRJdGVtUHJvcHMiLCJnZXRNZW51UHJvcHMiLCJpbmRleCIsIk9iamVjdCIsImVudHJpZXMiLCJtYXAiLCJzdWdnZXN0aW9ucyIsImxlbmd0aCIsInN1Z2dlc3Rpb24iLCJrZXkiLCJoaWdobGlnaHQiLCJpdGVtIiwiX19odG1sIiwidGl0bGVTbmlwcGV0IiwidGl0bGVGaWVsZCIsInRpdGxlUmF3IiwiaWQiLCJwcm9wVHlwZXMiLCJhbGxBdXRvY29tcGxldGVkSXRlbXNDb3VudCIsIlByb3BUeXBlcyIsIm51bWJlciIsImlzUmVxdWlyZWQiLCJvbmVPZlR5cGUiLCJib29sIiwic2hhcGUiLCJzdHJpbmciLCJ1cmxGaWVsZCIsImxpbmtUYXJnZXQiLCJhcnJheU9mIiwiUmVzdWx0Iiwib2JqZWN0T2YiLCJTdWdnZXN0aW9uIiwiYXV0b2NvbXBsZXRlZFN1Z2dlc3Rpb25zQ291bnQiLCJleGFjdCIsImZ1bmMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUEsU0FBU0EsTUFBVCxDQUFnQkMsTUFBaEIsRUFBd0JDLEtBQXhCLEVBQStCO0FBQzdCLE1BQUksQ0FBQ0QsTUFBTSxDQUFDQyxLQUFELENBQVAsSUFBa0IsQ0FBQ0QsTUFBTSxDQUFDQyxLQUFELENBQU4sQ0FBY0MsR0FBckMsRUFBMEM7QUFDMUMsU0FBT0YsTUFBTSxDQUFD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VixDQUFpQkosVUFGYjtBQUdkTSxJQUFBQSxVQUFVLEVBQUVSLG1CQUFVTSxNQUhSO0FBSWQvQixJQUFBQSxZQUFZLEVBQUV5QixtQkFBVU07QUFKVixHQUFoQixDQUZ1QyxDQUFwQixDQUZFO0FBV3ZCNUIsRUFBQUEsb0JBQW9CLEVBQUVzQixtQkFBVVMsT0FBVixDQUFrQkMsYUFBbEIsRUFBMEJSLFVBWHpCO0FBWXZCdkIsRUFBQUEsd0JBQXdCLEVBQUVxQixtQkFBVVcsUUFBVixDQUFtQlgsbUJBQVVTLE9BQVYsQ0FBa0JHLGlCQUFsQixDQUFuQixFQUN2QlYsVUFib0I7QUFjdkJXLEVBQUFBLDZCQUE2QixFQUFFYixtQkFBVUMsTUFBVixDQUFpQkMsVUFkekI7QUFldkI1QixFQUFBQSx1QkFBdUIsRUFBRTBCLG1CQUFVRyxTQUFWLENBQW9CLENBQzNDSCxtQkFBVUksSUFEaUMsRUFFM0NKLG1CQUFVYyxLQUFWLENBQWdCO0FBQ2R2QyxJQUFBQSxZQUFZLEVBQUV5QixtQkFBVU07QUFEVixHQUFoQixDQUYyQyxFQUszQ04sbUJBQVVXLFFBQVYsQ0FDRVgsbUJBQVVjLEtBQVYsQ0FBZ0I7QUFDZHZDLElBQUFBLFlBQVksRUFBRXlCLG1CQUFVTTtBQURWLEdBQWhCLENBREYsQ0FMMkMsQ0FBcEIsQ0FmRjtBQTBCdkJ6QixFQUFBQSxZQUFZLEVBQUVtQixtQkFBVWUsSUFBVixDQUFlYixVQTFCTjtBQTJCdkJwQixFQUFBQSxZQUFZLEVBQUVrQixtQkFBVWUsSUFBVixDQUFlYixVQTNCTjtBQTRCdkJ0QixFQUFBQSxTQUFTLEVBQUVvQixtQkFBVU07QUE1QkUsQ0FBekI7ZUErQmU5QixZIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFByb3BUeXBlcyBmcm9tIFwicHJvcC10eXBlc1wiO1xuaW1wb3J0IFJlYWN0IGZyb20gXCJyZWFjdFwiO1xuXG5pbXBvcnQgeyBSZXN1bHQgfSBmcm9tIFwiLi90eXBlc1wiO1xuaW1wb3J0IHsgU3VnZ2VzdGlvbiB9IGZyb20gXCIuL3R5cGVzXCI7XG5pbXBvcnQgeyBhcHBlbmRDbGFzc05hbWUgfSBmcm9tIFwiLi92aWV3LWhlbHBlcnNcIjtcblxuZnVuY3Rpb24gZ2V0UmF3KHJlc3VsdCwgdmFsdWUpIHtcbiAgaWYgKCFyZXN1bHRbdmFsdWVdIHx8ICFyZXN1bHRbdmFsdWVdLnJhdykgcmV0dXJuO1xuICByZXR1cm4gcmVzdWx0W3ZhbHVlXS5yYXc7XG59XG5cbmZ1bmN0aW9uIGdldFNuaXBwZXQocmVzdWx0LCB2YWx1ZSkge1xuICBpZiAoIXJlc3VsdFt2YWx1ZV0gfHwgIXJlc3VsdFt2YWx1ZV0uc25pcHBldCkgcmV0dXJuO1xuICByZXR1cm4gcmVzdWx0W3ZhbHVlXS5zbmlwcGV0O1xufVxuXG5mdW5jdGlvbiBnZXRTdWdnZXN0aW9uVGl0bGUoc3VnZ2VzdGlvblR5cGUsIGF1dG9jb21wbGV0ZVN1Z2dlc3Rpb25zKSB7XG4gIGlmIChhdXRvY29tcGxldGVTdWdnZXN0aW9ucy5zZWN0aW9uVGl0bGUpIHtcbiAgICByZXR1cm4gYXV0b2NvbXBsZXRlU3VnZ2VzdGlvbnMuc2VjdGlvblRpdGxlO1xuICB9XG5cbiAgaWYgKFxuICAgIGF1dG9jb21wbGV0ZVN1Z2dlc3Rpb25zW3N1Z2dlc3Rpb25UeXBlXSAmJlxuICAgIGF1dG9jb21wbGV0ZVN1Z2dlc3Rpb25zW3N1Z2dlc3Rpb25UeXBlXS5zZWN0aW9uVGl0bGVcbiAgKSB7XG4gICAgcmV0dXJuIGF1dG9jb21wbGV0ZVN1Z2dlc3Rpb25zW3N1Z2dlc3Rpb25UeXBlXS5zZWN0aW9uVGl0bGU7XG4gIH1cbn1cblxuZnVuY3Rpb24gQXV0b2NvbXBsZXRlKHtcbiAgYXV0b2NvbXBsZXRlUmVzdWx0cyxcbiAgYXV0b2NvbXBsZXRlZFJlc3VsdHMsXG4gIGF1dG9jb21wbGV0ZVN1Z2dlc3Rpb25zLFxuICBhdXRvY29tcGxldGVkU3VnZ2VzdGlvbnMsXG4gIGNsYXNzTmFtZSxcbiAgZ2V0SXRlbVByb3BzLFxuICBnZXRNZW51UHJvcHNcbn0pIHtcbiAgbGV0IGluZGV4ID0gMDtcbiAgcmV0dXJuIChcbiAgICA8ZGl2XG4gICAgICB7Li4uZ2V0TWVudVByb3BzKHtcbiAgICAgICAgY2xhc3NOYW1lOiBhcHBlbmRDbGFzc05hbWUoXG4gICAgICAgICAgXCJzdWktc2VhcmNoLWJveF9fYXV0b2NvbXBsZXRlLWNvbnRhaW5lclwiLFxuICAgICAgICAgIGNsYXNzTmFtZVxuICAgICAgICApXG4gICAgICB9KX1cbiAgICA+XG4gICAgICA8ZGl2PlxuICAgICAgICB7ISFhdXRvY29tcGxldGVTdWdnZXN0aW9ucyAmJlxuICAgICAgICAgIE9iamVjdC5lbnRyaWVzKGF1dG9jb21wbGV0ZWRTdWdnZXN0aW9ucykubWFwKFxuICAgICAgICAgICAgKFtzdWdnZXN0aW9uVHlwZSwgc3VnZ2VzdGlvbnNdKSA9PiB7XG4gICAgICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICAgICAgPFJlYWN0LkZyYWdtZW50IGtleT17c3VnZ2VzdGlvblR5cGV9PlxuICAgICAgICAgICAgICAgICAge2dldFN1Z2dlc3Rpb25UaXRsZShcbiAgICAgICAgICAgICAgICAgICAgc3VnZ2VzdGlvblR5cGUsXG4gICAgICAgICAgICAgICAgICAgIGF1dG9jb21wbGV0ZVN1Z2dlc3Rpb25zXG4gICAgICAgICAgICAgICAgICApICYmXG4gICAgICAgICAgICAgICAgICAgIHN1Z2dlc3Rpb25zLmxlbmd0aCA+IDAgJiYgKFxuICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwic3VpLXNlYXJjaC1ib3hfX3NlY3Rpb24tdGl0bGVcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgIHtnZXRTdWdnZXN0aW9uVGl0bGUoXG4gICAgICAgICAgICAgICAgICAgICAgICAgIHN1Z2dlc3Rpb25UeXBlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICBhdXRvY29tcGxldGVTdWdnZXN0aW9uc1xuICAgICAgICAgICAgICAgICAgICAgICAgKX1cbiAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgKX1cbiAgICAgICAgICAgICAgICAgIHtzdWdnZXN0aW9ucy5sZW5ndGggPiAwICYmIChcbiAgICAgICAgICAgICAgICAgICAgPHVsIGNsYXNzTmFtZT1cInN1aS1zZWFyY2gtYm94X19zdWdnZXN0aW9uLWxpc3RcIj5cbiAgICAgICAgICAgICAgICAgICAgICB7c3VnZ2VzdGlvbnMubWFwKHN1Z2dlc3Rpb24gPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXgrKztcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSByZWFjdC9qc3gta2V5XG4gICAgICAgICAgICAgICAgICAgICAgICAgIDxsaVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsuLi5nZXRJdGVtUHJvcHMoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAga2V5OlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWdnZXN0aW9uLnN1Z2dlc3Rpb24gfHwgc3VnZ2VzdGlvbi5oaWdobGlnaHQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmRleDogaW5kZXggLSAxLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbTogc3VnZ2VzdGlvblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pfVxuICAgICAgICAgICAgICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge3N1Z2dlc3Rpb24uaGlnaGxpZ2h0ID8gKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGFuZ2Vyb3VzbHlTZXRJbm5lckhUTUw9e3tcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfX2h0bWw6IHN1Z2dlc3Rpb24uaGlnaGxpZ2h0XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH19XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICkgOiAoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3Bhbj57c3VnZ2VzdGlvbi5zdWdnZXN0aW9ufTwvc3Bhbj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICApfVxuICAgICAgICAgICAgICAgICAgICAgICAgICA8L2xpPlxuICAgICAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICAgICAgICB9KX1cbiAgICAgICAgICAgICAgICAgICAgPC91bD5cbiAgICAgICAgICAgICAgICAgICl9XG4gICAgICAgICAgICAgICAgPC9SZWFjdC5GcmFnbWVudD5cbiAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICApfVxuICAgICAgICB7ISFhdXRvY29tcGxldGVSZXN1bHRzICYmXG4gICAgICAgICAgISFhdXRvY29tcGxldGVkUmVzdWx0cyAmJlxuICAgICAgICAgIGF1dG9jb21wbGV0ZWRSZXN1bHRzLmxlbmd0aCA+IDAgJiZcbiAgICAgICAgICBhdXRvY29tcGxldGVSZXN1bHRzLnNlY3Rpb25UaXRsZSAmJiAoXG4gICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cInN1aS1zZWFyY2gtYm94X19zZWN0aW9uLXRpdGxlXCI+XG4gICAgICAgICAgICAgIHthdXRvY29tcGxldGVSZXN1bHRzLnNlY3Rpb25UaXRsZX1cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICl9XG4gICAgICAgIHshIWF1dG9jb21wbGV0ZVJlc3VsdHMgJiZcbiAgICAgICAgICAhIWF1dG9jb21wbGV0ZWRSZXN1bHRzICYmXG4gICAgICAgICAgYXV0b2NvbXBsZXRlZFJlc3VsdHMubGVuZ3RoID4gMCAmJiAoXG4gICAgICAgICAgICA8dWwgY2xhc3NOYW1lPVwic3VpLXNlYXJjaC1ib3hfX3Jlc3VsdHMtbGlzdFwiPlxuICAgICAgICAgICAgICB7YXV0b2NvbXBsZXRlZFJlc3VsdHMubWFwKHJlc3VsdCA9PiB7XG4gICAgICAgICAgICAgICAgaW5kZXgrKztcbiAgICAgICAgICAgICAgICBjb25zdCB0aXRsZVNuaXBwZXQgPSBnZXRTbmlwcGV0KFxuICAgICAgICAgICAgICAgICAgcmVzdWx0LFxuICAgICAgICAgICAgICAgICAgYXV0b2NvbXBsZXRlUmVzdWx0cy50aXRsZUZpZWxkXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICBjb25zdCB0aXRsZVJhdyA9IGdldFJhdyhyZXN1bHQsIGF1dG9jb21wbGV0ZVJlc3VsdHMudGl0bGVGaWVsZCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSByZWFjdC9qc3gta2V5XG4gICAgICAgICAgICAgICAgICA8bGlcbiAgICAgICAgICAgICAgICAgICAgey4uLmdldEl0ZW1Qcm9wcyh7XG4gICAgICAgICAgICAgICAgICAgICAga2V5OiByZXN1bHQuaWQucmF3LFxuICAgICAgICAgICAgICAgICAgICAgIGluZGV4OiBpbmRleCAtIDEsXG4gICAgICAgICAgICAgICAgICAgICAgaXRlbTogcmVzdWx0XG4gICAgICAgICAgICAgICAgICAgIH0pfVxuICAgICAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgICAgICB7dGl0bGVTbmlwcGV0ID8gKFxuICAgICAgICAgICAgICAgICAgICAgIDxzcGFuXG4gICAgICAgICAgICAgICAgICAgICAgICBkYW5nZXJvdXNseVNldElubmVySFRNTD17e1xuICAgICAgICAgICAgICAgICAgICAgICAgICBfX2h0bWw6IHRpdGxlU25pcHBldFxuICAgICAgICAgICAgICAgICAgICAgICAgfX1cbiAgICAgICAgICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgICAgICAgICApIDogKFxuICAgICAgICAgICAgICAgICAgICAgIDxzcGFuPnt0aXRsZVJhd308L3NwYW4+XG4gICAgICAgICAgICAgICAgICAgICl9XG4gICAgICAgICAgICAgICAgICA8L2xpPlxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgIH0pfVxuICAgICAgICAgICAgPC91bD5cbiAgICAgICAgICApfVxuICAgICAgPC9kaXY+XG4gICAgPC9kaXY+XG4gICk7XG59XG5cbkF1dG9jb21wbGV0ZS5wcm9wVHlwZXMgPSB7XG4gIGFsbEF1dG9jb21wbGV0ZWRJdGVtc0NvdW50OiBQcm9wVHlwZXMubnVtYmVyLmlzUmVxdWlyZWQsXG4gIGF1dG9jb21wbGV0ZVJlc3VsdHM6IFByb3BUeXBlcy5vbmVPZlR5cGUoW1xuICAgIFByb3BUeXBlcy5ib29sLFxuICAgIFByb3BUeXBlcy5zaGFwZSh7XG4gICAgICB0aXRsZUZpZWxkOiBQcm9wVHlwZXMuc3RyaW5nLmlzUmVxdWlyZWQsXG4gICAgICB1cmxGaWVsZDogUHJvcFR5cGVzLnN0cmluZy5pc1JlcXVpcmVkLFxuICAgICAgbGlua1RhcmdldDogUHJvcFR5cGVzLnN0cmluZyxcbiAgICAgIHNlY3Rpb25UaXRsZTogUHJvcFR5cGVzLnN0cmluZ1xuICAgIH0pXG4gIF0pLFxuICBhdXRvY29tcGxldGVkUmVzdWx0czogUHJvcFR5cGVzLmFycmF5T2YoUmVzdWx0KS5pc1JlcXVpcmVkLFxuICBhdXRvY29tcGxldGVkU3VnZ2VzdGlvbnM6IFByb3BUeXBlcy5vYmplY3RPZihQcm9wVHlwZXMuYXJyYXlPZihTdWdnZXN0aW9uKSlcbiAgICAuaXNSZXF1aXJlZCxcbiAgYXV0b2NvbXBsZXRlZFN1Z2dlc3Rpb25zQ291bnQ6IFByb3BUeXBlcy5udW1iZXIuaXNSZXF1aXJlZCxcbiAgYXV0b2NvbXBsZXRlU3VnZ2VzdGlvbnM6IFByb3BUeXBlcy5vbmVPZlR5cGUoW1xuICAgIFByb3BUeXBlcy5ib29sLFxuICAgIFByb3BUeXBlcy5leGFjdCh7XG4gICAgICBzZWN0aW9uVGl0bGU6IFByb3BUeXBlcy5zdHJpbmdcbiAgICB9KSxcbiAgICBQcm9wVHlwZXMub2JqZWN0T2YoXG4gICAgICBQcm9wVHlwZXMuZXhhY3Qoe1xuICAgICAgICBzZWN0aW9uVGl0bGU6IFByb3BUeXBlcy5zdHJpbmdcbiAgICAgIH0pXG4gICAgKVxuICBdKSxcbiAgZ2V0SXRlbVByb3BzOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICBnZXRNZW51UHJvcHM6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXG4gIGNsYXNzTmFtZTogUHJvcFR5cGVzLnN0cmluZ1xufTtcblxuZXhwb3J0IGRlZmF1bHQgQXV0b2NvbXBsZXRlO1xuIl19