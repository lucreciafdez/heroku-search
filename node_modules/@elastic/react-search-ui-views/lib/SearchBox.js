"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _objectWithoutProperties2 = _interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _react = _interopRequireDefault(require("react"));

var _downshift = _interopRequireDefault(require("downshift"));

var _types = require("./types");

var _viewHelpers = require("./view-helpers");

var _Autocomplete = _interopRequireDefault(require("./Autocomplete"));

var _SearchInput = _interopRequireDefault(require("./SearchInput"));

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(source, true).forEach(function (key) { (0, _defineProperty2.default)(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(source).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

function SearchBox(props) {
  var className = props.className,
      allAutocompletedItemsCount = props.allAutocompletedItemsCount,
      autocompleteView = props.autocompleteView,
      isFocused = props.isFocused,
      _props$inputProps = props.inputProps,
      inputProps = _props$inputProps === void 0 ? {} : _props$inputProps,
      inputView = props.inputView,
      onChange = props.onChange,
      onSelectAutocomplete = props.onSelectAutocomplete,
      _onSubmit = props.onSubmit,
      useAutocomplete = props.useAutocomplete,
      value = props.value,
      autocompletedResults = props.autocompletedResults,
      autocompletedSuggestions = props.autocompletedSuggestions,
      autocompletedSuggestionsCount = props.autocompletedSuggestionsCount,
      completeSuggestion = props.completeSuggestion,
      notifyAutocompleteSelected = props.notifyAutocompleteSelected,
      rest = (0, _objectWithoutProperties2.default)(props, ["className", "allAutocompletedItemsCount", "autocompleteView", "isFocused", "inputProps", "inputView", "onChange", "onSelectAutocomplete", "onSubmit", "useAutocomplete", "value", "autocompletedResults", "autocompletedSuggestions", "autocompletedSuggestionsCount", "completeSuggestion", "notifyAutocompleteSelected"]);
  var focusedClass = isFocused ? "focus" : "";
  var AutocompleteView = autocompleteView || _Autocomplete.default;
  var InputView = inputView || _SearchInput.default;
  return _react.default.createElement(_downshift.default, (0, _extends2.default)({
    inputValue: value,
    onChange: onSelectAutocomplete,
    onInputValueChange: function onInputValueChange(newValue) {
      // To avoid over dispatching
      if (value === newValue) return;
      onChange(newValue);
    } // Because when a selection is made, we don't really want to change
    // the inputValue. This is supposed to be a "controlled" value, and when
    // this happens we lose control of it.
    ,
    itemToString: function itemToString() {
      return value;
    }
  }, rest), function (downshiftProps) {
    var closeMenu = downshiftProps.closeMenu,
        _getInputProps = downshiftProps.getInputProps,
        isOpen = downshiftProps.isOpen;
    var autocompleteClass = isOpen === true ? " autocomplete" : "";
    return _react.default.createElement("form", {
      onSubmit: function onSubmit(e) {
        closeMenu();

        _onSubmit(e);
      }
    }, _react.default.createElement("div", {
      className: (0, _viewHelpers.appendClassName)("sui-search-box", className) + autocompleteClass
    }, _react.default.createElement(InputView, (0, _extends2.default)({}, downshiftProps, {
      getInputProps: function getInputProps(additionalProps) {
        var _ref = additionalProps || {},
            className = _ref.className,
            rest = (0, _objectWithoutProperties2.default)(_ref, ["className"]);

        return _getInputProps(_objectSpread({
          placeholder: "Search"
        }, inputProps, {
          className: (0, _viewHelpers.appendClassName)("sui-search-box__text-input", [inputProps.className, className, focusedClass])
        }, rest));
      },
      getButtonProps: function getButtonProps(additionalProps) {
        var _ref2 = additionalProps || {},
            className = _ref2.className,
            rest = (0, _objectWithoutProperties2.default)(_ref2, ["className"]);

        return _objectSpread({
          type: "submit",
          value: "Search",
          className: (0, _viewHelpers.appendClassName)("button sui-search-box__submit", className)
        }, rest);
      },
      getAutocomplete: function getAutocomplete() {
        if (useAutocomplete && isOpen && allAutocompletedItemsCount > 0) {
          return _react.default.createElement(AutocompleteView, (0, _extends2.default)({}, props, downshiftProps));
        } else {
          return null;
        }
      }
    }))));
  });
}

SearchBox.propTypes = {
  // Provided by container
  allAutocompletedItemsCount: _propTypes.default.number.isRequired,
  autocompletedResults: _propTypes.default.arrayOf(_types.Result).isRequired,
  autocompletedSuggestions: _propTypes.default.objectOf(_propTypes.default.arrayOf(_types.Suggestion)).isRequired,
  autocompletedSuggestionsCount: _propTypes.default.number.isRequired,
  completeSuggestion: _propTypes.default.func.isRequired,
  notifyAutocompleteSelected: _propTypes.default.func.isRequired,
  onChange: _propTypes.default.func.isRequired,
  onSubmit: _propTypes.default.func.isRequired,
  value: _propTypes.default.string.isRequired,
  autocompleteResults: _propTypes.default.oneOfType([_propTypes.default.bool, _propTypes.default.shape({
    titleField: _propTypes.default.string.isRequired,
    urlField: _propTypes.default.string.isRequired,
    linkTarget: _propTypes.default.string,
    sectionTitle: _propTypes.default.string
  })]),
  autocompleteView: _propTypes.default.func,
  autocompleteSuggestions: _propTypes.default.oneOfType([_propTypes.default.bool, _propTypes.default.exact({
    sectionTitle: _propTypes.default.string
  }), _propTypes.default.objectOf(_propTypes.default.exact({
    sectionTitle: _propTypes.default.string
  }))]),
  className: _propTypes.default.string,
  inputProps: _propTypes.default.object,
  inputView: _propTypes.default.func,
  isFocused: _propTypes.default.bool,
  useAutocomplete: _propTypes.default.bool,
  // Specific configuration for this view only
  onSelectAutocomplete: _propTypes.default.func
};
var _default = SearchBox;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9TZWFyY2hCb3guanMiXSwibmFtZXMiOlsiU2VhcmNoQm94IiwicHJvcHMiLCJjbGFzc05hbWUiLCJhbGxBdXRvY29tcGxldGVkSXRlbXNDb3VudCIsImF1dG9jb21wbGV0ZVZpZXciLCJpc0ZvY3VzZWQiLCJpbnB1dFByb3BzIiwiaW5wdXRWaWV3Iiwib25DaGFuZ2UiLCJvblNlbGVjdEF1dG9jb21wbGV0ZSIsIm9uU3VibWl0IiwidXNlQXV0b2NvbXBsZXRlIiwidmFsdWUiLCJhdXRvY29tcGxldGVkUmVzdWx0cyIsImF1dG9jb21wbGV0ZWRTdWdnZXN0aW9ucyIsImF1dG9jb21wbGV0ZWRTdWdnZXN0aW9uc0NvdW50IiwiY29tcGxldGVTdWdnZXN0aW9uIiwibm90aWZ5QXV0b2NvbXBsZXRlU2VsZWN0ZWQiLCJyZXN0IiwiZm9jdXNlZENsYXNzIiwiQXV0b2NvbXBsZXRlVmlldyIsIkF1dG9jb21wbGV0ZSIsIklucHV0VmlldyIsIlNlYXJjaElucHV0IiwibmV3VmFsdWUiLCJkb3duc2hpZnRQcm9wcyIsImNsb3NlTWVudSIsImdldElucHV0UHJvcHMiLCJpc09wZW4iLCJhdXRvY29tcGxldGVDbGFzcyIsImUiLCJhZGRpdGlvbmFsUHJvcHMiLCJwbGFjZWhvbGRlciIsInR5cGUiLCJwcm9wVHlwZXMiLCJQcm9wVHlwZXMiLCJudW1iZXIiLCJpc1JlcXVpcmVkIiwiYXJyYXlPZiIsIlJlc3VsdCIsIm9iamVjdE9mIiwiU3VnZ2VzdGlvbiIsImZ1bmMiLCJzdHJpbmciLCJhdXRvY29tcGxldGVSZXN1bHRzIiwib25lT2ZUeXBlIiwiYm9vbCIsInNoYXBlIiwidGl0bGVGaWVsZCIsInVybEZpZWxkIiwibGlua1RhcmdldCIsInNlY3Rpb25UaXRsZSIsImF1dG9jb21wbGV0ZVN1Z2dlc3Rpb25zIiwiZXhhY3QiLCJvYmplY3QiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUVBOztBQUVBOztBQUVBOztB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QUFpQ3BCekMsRUFBQUEsU0FBUyxFQUFFaUMsbUJBQVVRLE1BakNEO0FBa0NwQnJDLEVBQUFBLFVBQVUsRUFBRTZCLG1CQUFVbUIsTUFsQ0Y7QUFtQ3BCL0MsRUFBQUEsU0FBUyxFQUFFNEIsbUJBQVVPLElBbkNEO0FBb0NwQnJDLEVBQUFBLFNBQVMsRUFBRThCLG1CQUFVVyxJQXBDRDtBQXFDcEJuQyxFQUFBQSxlQUFlLEVBQUV3QixtQkFBVVcsSUFyQ1A7QUF1Q3BCO0FBQ0FyQyxFQUFBQSxvQkFBb0IsRUFBRTBCLG1CQUFVTztBQXhDWixDQUF0QjtlQTJDZTFDLFMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUHJvcFR5cGVzIGZyb20gXCJwcm9wLXR5cGVzXCI7XG5pbXBvcnQgUmVhY3QgZnJvbSBcInJlYWN0XCI7XG5pbXBvcnQgRG93bnNoaWZ0IGZyb20gXCJkb3duc2hpZnRcIjtcblxuaW1wb3J0IHsgUmVzdWx0IH0gZnJvbSBcIi4vdHlwZXNcIjtcbmltcG9ydCB7IFN1Z2dlc3Rpb24gfSBmcm9tIFwiLi90eXBlc1wiO1xuaW1wb3J0IHsgYXBwZW5kQ2xhc3NOYW1lIH0gZnJvbSBcIi4vdmlldy1oZWxwZXJzXCI7XG5cbmltcG9ydCBBdXRvY29tcGxldGUgZnJvbSBcIi4vQXV0b2NvbXBsZXRlXCI7XG5pbXBvcnQgU2VhcmNoSW5wdXQgZnJvbSBcIi4vU2VhcmNoSW5wdXRcIjtcblxuZnVuY3Rpb24gU2VhcmNoQm94KHByb3BzKSB7XG4gIGNvbnN0IHtcbiAgICBjbGFzc05hbWUsXG4gICAgYWxsQXV0b2NvbXBsZXRlZEl0ZW1zQ291bnQsXG4gICAgYXV0b2NvbXBsZXRlVmlldyxcbiAgICBpc0ZvY3VzZWQsXG4gICAgaW5wdXRQcm9wcyA9IHt9LFxuICAgIGlucHV0VmlldyxcbiAgICBvbkNoYW5nZSxcbiAgICBvblNlbGVjdEF1dG9jb21wbGV0ZSxcbiAgICBvblN1Ym1pdCxcbiAgICB1c2VBdXRvY29tcGxldGUsXG4gICAgdmFsdWUsXG4gICAgLy8gTk9URTogVGhlc2UgYXJlIGV4cGxpY2l0bHkgZGUtc3RydWN0dXJlZCBidXQgbm90IHVzZWQgc28gdGhhdCB0aGV5IGFyZVxuICAgIC8vIG5vdCBwYXNzZWQgdGhyb3VnaCB0byB0aGUgaW5wdXQgd2l0aCB0aGUgJ3Jlc3QnIHBhcmFtZXRlclxuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby11bnVzZWQtdmFyc1xuICAgIGF1dG9jb21wbGV0ZWRSZXN1bHRzLFxuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby11bnVzZWQtdmFyc1xuICAgIGF1dG9jb21wbGV0ZWRTdWdnZXN0aW9ucyxcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tdW51c2VkLXZhcnNcbiAgICBhdXRvY29tcGxldGVkU3VnZ2VzdGlvbnNDb3VudCxcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tdW51c2VkLXZhcnNcbiAgICBjb21wbGV0ZVN1Z2dlc3Rpb24sXG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXVudXNlZC12YXJzXG4gICAgbm90aWZ5QXV0b2NvbXBsZXRlU2VsZWN0ZWQsXG4gICAgLi4ucmVzdFxuICB9ID0gcHJvcHM7XG4gIGNvbnN0IGZvY3VzZWRDbGFzcyA9IGlzRm9jdXNlZCA/IFwiZm9jdXNcIiA6IFwiXCI7XG4gIGNvbnN0IEF1dG9jb21wbGV0ZVZpZXcgPSBhdXRvY29tcGxldGVWaWV3IHx8IEF1dG9jb21wbGV0ZTtcbiAgY29uc3QgSW5wdXRWaWV3ID0gaW5wdXRWaWV3IHx8IFNlYXJjaElucHV0O1xuXG4gIHJldHVybiAoXG4gICAgPERvd25zaGlmdFxuICAgICAgaW5wdXRWYWx1ZT17dmFsdWV9XG4gICAgICBvbkNoYW5nZT17b25TZWxlY3RBdXRvY29tcGxldGV9XG4gICAgICBvbklucHV0VmFsdWVDaGFuZ2U9e25ld1ZhbHVlID0+IHtcbiAgICAgICAgLy8gVG8gYXZvaWQgb3ZlciBkaXNwYXRjaGluZ1xuICAgICAgICBpZiAodmFsdWUgPT09IG5ld1ZhbHVlKSByZXR1cm47XG4gICAgICAgIG9uQ2hhbmdlKG5ld1ZhbHVlKTtcbiAgICAgIH19XG4gICAgICAvLyBCZWNhdXNlIHdoZW4gYSBzZWxlY3Rpb24gaXMgbWFkZSwgd2UgZG9uJ3QgcmVhbGx5IHdhbnQgdG8gY2hhbmdlXG4gICAgICAvLyB0aGUgaW5wdXRWYWx1ZS4gVGhpcyBpcyBzdXBwb3NlZCB0byBiZSBhIFwiY29udHJvbGxlZFwiIHZhbHVlLCBhbmQgd2hlblxuICAgICAgLy8gdGhpcyBoYXBwZW5zIHdlIGxvc2UgY29udHJvbCBvZiBpdC5cbiAgICAgIGl0ZW1Ub1N0cmluZz17KCkgPT4gdmFsdWV9XG4gICAgICB7Li4ucmVzdH1cbiAgICA+XG4gICAgICB7ZG93bnNoaWZ0UHJvcHMgPT4ge1xuICAgICAgICBjb25zdCB7IGNsb3NlTWVudSwgZ2V0SW5wdXRQcm9wcywgaXNPcGVuIH0gPSBkb3duc2hpZnRQcm9wcztcbiAgICAgICAgbGV0IGF1dG9jb21wbGV0ZUNsYXNzID0gaXNPcGVuID09PSB0cnVlID8gXCIgYXV0b2NvbXBsZXRlXCIgOiBcIlwiO1xuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgIDxmb3JtXG4gICAgICAgICAgICBvblN1Ym1pdD17ZSA9PiB7XG4gICAgICAgICAgICAgIGNsb3NlTWVudSgpO1xuICAgICAgICAgICAgICBvblN1Ym1pdChlKTtcbiAgICAgICAgICAgIH19XG4gICAgICAgICAgPlxuICAgICAgICAgICAgPGRpdlxuICAgICAgICAgICAgICBjbGFzc05hbWU9e1xuICAgICAgICAgICAgICAgIGFwcGVuZENsYXNzTmFtZShcInN1aS1zZWFyY2gtYm94XCIsIGNsYXNzTmFtZSkgKyBhdXRvY29tcGxldGVDbGFzc1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICA+XG4gICAgICAgICAgICAgIDxJbnB1dFZpZXdcbiAgICAgICAgICAgICAgICB7Li4uZG93bnNoaWZ0UHJvcHN9XG4gICAgICAgICAgICAgICAgZ2V0SW5wdXRQcm9wcz17YWRkaXRpb25hbFByb3BzID0+IHtcbiAgICAgICAgICAgICAgICAgIGNvbnN0IHsgY2xhc3NOYW1lLCAuLi5yZXN0IH0gPSBhZGRpdGlvbmFsUHJvcHMgfHwge307XG4gICAgICAgICAgICAgICAgICByZXR1cm4gZ2V0SW5wdXRQcm9wcyh7XG4gICAgICAgICAgICAgICAgICAgIHBsYWNlaG9sZGVyOiBcIlNlYXJjaFwiLFxuICAgICAgICAgICAgICAgICAgICAuLi5pbnB1dFByb3BzLFxuICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU6IGFwcGVuZENsYXNzTmFtZShcInN1aS1zZWFyY2gtYm94X190ZXh0LWlucHV0XCIsIFtcbiAgICAgICAgICAgICAgICAgICAgICBpbnB1dFByb3BzLmNsYXNzTmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWUsXG4gICAgICAgICAgICAgICAgICAgICAgZm9jdXNlZENsYXNzXG4gICAgICAgICAgICAgICAgICAgIF0pLFxuICAgICAgICAgICAgICAgICAgICAuLi5yZXN0XG4gICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9fVxuICAgICAgICAgICAgICAgIGdldEJ1dHRvblByb3BzPXthZGRpdGlvbmFsUHJvcHMgPT4ge1xuICAgICAgICAgICAgICAgICAgY29uc3QgeyBjbGFzc05hbWUsIC4uLnJlc3QgfSA9IGFkZGl0aW9uYWxQcm9wcyB8fCB7fTtcbiAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgIHR5cGU6IFwic3VibWl0XCIsXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiBcIlNlYXJjaFwiLFxuICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU6IGFwcGVuZENsYXNzTmFtZShcbiAgICAgICAgICAgICAgICAgICAgICBcImJ1dHRvbiBzdWktc2VhcmNoLWJveF9fc3VibWl0XCIsXG4gICAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lXG4gICAgICAgICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgICAgICAgIC4uLnJlc3RcbiAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgfX1cbiAgICAgICAgICAgICAgICBnZXRBdXRvY29tcGxldGU9eygpID0+IHtcbiAgICAgICAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgICAgICAgdXNlQXV0b2NvbXBsZXRlICYmXG4gICAgICAgICAgICAgICAgICAgIGlzT3BlbiAmJlxuICAgICAgICAgICAgICAgICAgICBhbGxBdXRvY29tcGxldGVkSXRlbXNDb3VudCA+IDBcbiAgICAgICAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gPEF1dG9jb21wbGV0ZVZpZXcgey4uLnByb3BzfSB7Li4uZG93bnNoaWZ0UHJvcHN9IC8+O1xuICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfX1cbiAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgIDwvZm9ybT5cbiAgICAgICAgKTtcbiAgICAgIH19XG4gICAgPC9Eb3duc2hpZnQ+XG4gICk7XG59XG5cblNlYXJjaEJveC5wcm9wVHlwZXMgPSB7XG4gIC8vIFByb3ZpZGVkIGJ5IGNvbnRhaW5lclxuICBhbGxBdXRvY29tcGxldGVkSXRlbXNDb3VudDogUHJvcFR5cGVzLm51bWJlci5pc1JlcXVpcmVkLFxuICBhdXRvY29tcGxldGVkUmVzdWx0czogUHJvcFR5cGVzLmFycmF5T2YoUmVzdWx0KS5pc1JlcXVpcmVkLFxuICBhdXRvY29tcGxldGVkU3VnZ2VzdGlvbnM6IFByb3BUeXBlcy5vYmplY3RPZihQcm9wVHlwZXMuYXJyYXlPZihTdWdnZXN0aW9uKSlcbiAgICAuaXNSZXF1aXJlZCxcbiAgYXV0b2NvbXBsZXRlZFN1Z2dlc3Rpb25zQ291bnQ6IFByb3BUeXBlcy5udW1iZXIuaXNSZXF1aXJlZCxcbiAgY29tcGxldGVTdWdnZXN0aW9uOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICBub3RpZnlBdXRvY29tcGxldGVTZWxlY3RlZDogUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCxcbiAgb25DaGFuZ2U6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXG4gIG9uU3VibWl0OiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICB2YWx1ZTogUHJvcFR5cGVzLnN0cmluZy5pc1JlcXVpcmVkLFxuICBhdXRvY29tcGxldGVSZXN1bHRzOiBQcm9wVHlwZXMub25lT2ZUeXBlKFtcbiAgICBQcm9wVHlwZXMuYm9vbCxcbiAgICBQcm9wVHlwZXMuc2hhcGUoe1xuICAgICAgdGl0bGVGaWVsZDogUHJvcFR5cGVzLnN0cmluZy5pc1JlcXVpcmVkLFxuICAgICAgdXJsRmllbGQ6IFByb3BUeXBlcy5zdHJpbmcuaXNSZXF1aXJlZCxcbiAgICAgIGxpbmtUYXJnZXQ6IFByb3BUeXBlcy5zdHJpbmcsXG4gICAgICBzZWN0aW9uVGl0bGU6IFByb3BUeXBlcy5zdHJpbmdcbiAgICB9KVxuICBdKSxcbiAgYXV0b2NvbXBsZXRlVmlldzogUHJvcFR5cGVzLmZ1bmMsXG4gIGF1dG9jb21wbGV0ZVN1Z2dlc3Rpb25zOiBQcm9wVHlwZXMub25lT2ZUeXBlKFtcbiAgICBQcm9wVHlwZXMuYm9vbCxcbiAgICBQcm9wVHlwZXMuZXhhY3Qoe1xuICAgICAgc2VjdGlvblRpdGxlOiBQcm9wVHlwZXMuc3RyaW5nXG4gICAgfSksXG4gICAgUHJvcFR5cGVzLm9iamVjdE9mKFxuICAgICAgUHJvcFR5cGVzLmV4YWN0KHtcbiAgICAgICAgc2VjdGlvblRpdGxlOiBQcm9wVHlwZXMuc3RyaW5nXG4gICAgICB9KVxuICAgIClcbiAgXSksXG4gIGNsYXNzTmFtZTogUHJvcFR5cGVzLnN0cmluZyxcbiAgaW5wdXRQcm9wczogUHJvcFR5cGVzLm9iamVjdCxcbiAgaW5wdXRWaWV3OiBQcm9wVHlwZXMuZnVuYyxcbiAgaXNGb2N1c2VkOiBQcm9wVHlwZXMuYm9vbCxcbiAgdXNlQXV0b2NvbXBsZXRlOiBQcm9wVHlwZXMuYm9vbCxcblxuICAvLyBTcGVjaWZpYyBjb25maWd1cmF0aW9uIGZvciB0aGlzIHZpZXcgb25seVxuICBvblNlbGVjdEF1dG9jb21wbGV0ZTogUHJvcFR5cGVzLmZ1bmNcbn07XG5cbmV4cG9ydCBkZWZhdWx0IFNlYXJjaEJveDtcbiJdfQ==